{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Dashboard - VITGrad</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <link rel="stylesheet" href="{% static 'css/style.css' %}">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="{% static 'js/careers.js' %}"></script>
  <style>
    /* Base Styles */
    body.dashboard-body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background: #f3f4f6;
    }
    .dashboard-wrapper {
      display: flex;
      min-height: 100vh;
    }
    .dashboard-sidebar {
      width: 280px;
      background: white;
      box-shadow: 2px 0 10px rgba(0,0,0,0.1);
    }
    .sidebar-header {
      padding: 1.5rem;
      display: flex;
      align-items: center;
      border-bottom: 1px solid #e5e7eb;
    }
    .logo-img {
      height: 50px;
      margin-right: 10px;
    }
    .sidebar-nav ul {
      list-style: none;
      padding: 1rem;
    }
    .sidebar-nav li a {
      display: flex;
      align-items: center;
      padding: 0.75rem 1rem;
      border-radius: 8px;
      color: #64748b;
      text-decoration: none;
      transition: all 0.2s;
    }
    .sidebar-nav li a:hover, .sidebar-nav li a.active {
      background: #2563eb;
      color: white;
    }
    .dashboard-main {
      flex: 1;
      overflow-x: hidden;
    }
    .dashboard-header {
      background: white;
      padding: 1rem 2rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    .btn-logout {
      color: #dc2626;
      text-decoration: none;
    }
    .content-section {
      display: none;
      padding: 2rem;
    }
    .content-section.active {
      display: block;
    }
    .cards-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 1.5rem;
      margin-bottom: 2rem;
    }
    .card {
      background: white;
      border-radius: 10px;
      padding: 1.5rem;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    .charts-container {
      display: flex;
      gap: 0.5rem;
      justify-content: space-between;
      flex-wrap: wrap;
    }
    .chart-card {
      width: 40%;
      background: white;
      padding: 50px;
      border-radius: 10px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    canvas {
      height: 200px !important;
    }
    .user-profile {
      position: relative;
      display: inline-block;
    }
    .profile-pic {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      cursor: pointer;
    }
    .profile-dropdown {
      display: none;
      position: absolute;
      right: 0;
      background: white;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      padding: 1rem;
      min-width: 200px;
      z-index: 1000;
    }
    .profile-dropdown.show { display: block; }
    .modal {
      display: none;
      position: fixed;
      z-index: 1001;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      overflow: auto;
      background-color: rgba(0,0,0,0.4);
    }
    
    .modal-content {
      background-color: #fff;
      margin: 5% auto;
      padding: 20px;
      border-radius: 8px;
      width: 50%;
      max-width: 600px;
    }
    
    .close {
      color: #aaa;
      float: right;
      font-size: 28px;
      font-weight: bold;
      cursor: pointer;
    }
    
    .form-group {
      margin-bottom: 1rem;
    }
    
    .form-group label {
      display: block;
      margin-bottom: 0.5rem;
    }
    
    .form-group input,
    .form-group textarea {
      width: 100%;
      padding: 0.5rem;
      border: 1px solid #ddd;
      border-radius: 4px;
    }

    .spinner {
      width: 50px;
      height: 50px;
      border: 6px solid #ccc;
      border-top-color: #3498db;
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }
    
    @keyframes spin {
      to {
        transform: rotate(360deg);
      }
    }
  </style>
</head>
<body class="dashboard-body">
  <div class="dashboard-wrapper">
    <aside class="dashboard-sidebar">
      <div class="sidebar-header">
        <img src="{% static 'images/vit_logo.webp' %}" alt="VITGrad Logo" class="logo-img">
        <h1 class="logo">VITGrad</h1>
      </div>
      <nav class="sidebar-nav">
        <ul>
          <li><a href="#dashboard" class="active">Dashboard</a></li>
          <li><a href="#alumni">Alumni</a></li>
          <li><a href="#events">Events</a></li>
          <li><a href="#careers">Careers</a></li>
          <li><a href="#posts">Posts</a></li>
          <li><a href="#donation">Donation</a></li>
          <li><a href="#management">Management</a></li>
        </ul>
      </nav>
    </aside>
    <main class="dashboard-main">
      <header class="dashboard-header">
        <h2>Admin Dashboard</h2>
        <div class="user-profile">
          <img src="{% static 'images/avatar.png' %}" alt="Profile" class="profile-pic">
          <div class="profile-dropdown">
            <p>Logged in as: <strong>Admin</strong></p>
          </div>
        </div>
        <a href="#" class="btn-logout" data-logout-url="{% url 'logout' %}" onclick="confirmLogout(event)">
          <i class="fas fa-sign-out-alt"></i> Logout
        </a>
      </header>
      <div class="dashboard-content">

        <div id="loader-overlay" style="display: none;">
          <div id="loader">Logging out...</div>
        </div>

        <div id="pageLoader" style="display: flex;position: fixed;top: 0; left: 0;width: 100%; height: 100%;background: rgba(255, 255, 255, 0.8);z-index: 9999;align-items: center;justify-content: center;">
          <div class="spinner"></div>
        </div>
            
        <!-- Dashboard Section -->
        <div id="dashboard" class="content-section active">
          <div class="cards-grid">
            <div class="card">
              <div class="card-header">
                <i class="fas fa-users"></i>
                <h3>Total Alumni</h3>
              </div>
              <div class="card-body">
                <p>1,234</p>
              </div>
            </div>
            <div class="card">
              <div class="card-header">
                <i class="fas fa-calendar-alt"></i>
                <h3>Upcoming Events</h3>
              </div>
              <div class="card-body">
                <p>5</p>
              </div>
            </div>
            <div class="card">
              <div class="card-header">
                <i class="fas fa-briefcase"></i>
                <h3>Job Postings</h3>
              </div>
              <div class="card-body">
                <p>23</p>
              </div>
            </div>
            <div class="card">
              <div class="card-header">
                <i class="fas fa-chart-line"></i>
                <h3>Engagement Rate</h3>
              </div>
              <div class="card-body">
                <p>78%</p>
              </div>
            </div>
          </div>
          <div class="charts-container">
            <div class="chart-card">
              <h3>Alumni Growth Over Time</h3>
              <canvas id="alumniGrowthChart"></canvas>
            </div>
            <div class="chart-card">
              <h3>Event Participation</h3>
              <canvas id="eventParticipationChart"></canvas>
            </div>
          </div>
        </div>


        <!-- Alumni Section -->
        <div id="alumni" class="content-section">
            <div class="section-header" style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap;">
            <h3>Alumni Management</h3>
            <div class="alumni-actions" style="display: flex; gap: 10px; flex-wrap: wrap; align-items: center;">
                <!-- Search Box -->
                <form id="alumniSearchForm" method="GET" action="{% url 'admindash' %}" style="display: flex; gap: 10px; align-items: center;">
                    <input type="text" id="alumniSearch" name="search" placeholder="Search alumni..." value="{{ search_query }}" style="padding: 0.5rem; border: 1px solid #e5e7eb; border-radius: 5px;">
                    <!-- Sort Dropdown -->
                    <select id="alumniSort" name="sort" style="padding: 0.5rem; border: 1px solid #e5e7eb; border-radius: 5px;">
                        <option value="">Sort By</option>
                        <option value="name" {% if sort_by == 'name' %}selected{% endif %}>Name</option>
                        <option value="email" {% if sort_by == 'email' %}selected{% endif %}>Email</option>
                        <option value="city" {% if sort_by == 'city' %}selected{% endif %}>City</option>
                    </select>
                    <!-- Action Buttons -->
                    <button type="submit" class="btn-primary">
                        <i class="fas fa-search"></i> Search
                    </button>
                    <button type="button" class="btn-primary" id="btnOpenModalAddAlumni">
                        <i class="fas fa-plus"></i> Add Alumni
                    </button>
                </form>
            </div>
            </div>
            <div class="table-container">
                <div class="table-info">
                    <p>Showing {{ alumni_data.start_index }} to {{ alumni_data.end_index }} of {{ total_alumni }} alumni</p>
                </div>
                <table class="data-table" id="alumniTable">
                    <thead>
                        <tr>
                            <th>First Name</th>
                            <th>Last Name</th>
                            <th>Full Name</th>
                            <th>Date of Birth</th>
                            <th>Age</th>
                            <th>Email</th>
                            <th>Phone</th>
                            <th>Address</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for alumni in alumni_data %}
                            <tr>
                                <td>{{ alumni.first_name }}</td>
                                <td>{{ alumni.last_name }}</td>
                                <td>{{ alumni.alumni_name }}</td>
                                <td>{{ alumni.DOB }}</td>
                                <td>{{ alumni.age }}</td>
                                <td>{{ alumni.alumni_email }}</td>
                                <td>{{ alumni.alumni_phone }}</td>
                                <td>{{ alumni.address }}</td>
                                <td>
                                  <form method="POST" action="{% url 'delete_alumni' %}" style="display: inline;">
                                    {% csrf_token %}
                                    <input type="hidden" name="alumni_email" value="{{ alumni.alumni_email }}">
                                    <button type="submit" class="btn-action delete" title="Delete" onclick="confirmDeleteAlumni({{ alumni.alumni_email }})">
                                      <i class="fas fa-trash"></i>
                                    </button>
                                  </form>
                                </td>
                              
                            </tr>
                        {% empty %}
                            <tr>
                                <td colspan="12">No alumni data available.</td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
                
                <!-- Pagination -->
                {% if alumni_data.has_other_pages %}
                <div class="pagination">
                    <ul class="pagination-list">
                        {% if alumni_data.has_previous %}
                            <li><a href="?page={{ alumni_data.previous_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}{% if sort_by %}&sort={{ sort_by }}{% endif %}" class="pagination-link">&laquo; Previous</a></li>
                        {% else %}
                            <li class="disabled"><span class="pagination-link">&laquo; Previous</span></li>
                        {% endif %}
                        
                        {% for i in alumni_data.paginator.page_range %}
                            {% if alumni_data.number == i %}
                                <li class="active"><span class="pagination-link">{{ i }}</span></li>
                            {% else %}
                                <li><a href="?page={{ i }}{% if search_query %}&search={{ search_query }}{% endif %}{% if sort_by %}&sort={{ sort_by }}{% endif %}" class="pagination-link">{{ i }}</a></li>
                            {% endif %}
                        {% endfor %}
                        
                        {% if alumni_data.has_next %}
                            <li><a href="?page={{ alumni_data.next_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}{% if sort_by %}&sort={{ sort_by }}{% endif %}" class="pagination-link">Next &raquo;</a></li>
                        {% else %}
                            <li class="disabled"><span class="pagination-link">Next &raquo;</span></li>
                        {% endif %}
                    </ul>
                </div>
                {% endif %}
            </div>
        </div>
  
     <!-- Events Section -->
      <div id="events" class="content-section">
        <div class="section-header" style="display: flex; justify-content: space-between; align-items: center;">
          <h3>Events Management</h3>
          <button class="btn-primary" id="btnOpenModalAddEvent">
            <i class="fas fa-plus"></i> New Event
          </button>
        </div>

        <div class="table-container" style="margin-top: 20px;">
          <table class="data-table" style="width: 100%; border-collapse: collapse;">
            <thead>
              <tr style="background-color: #f3f4f6; text-align: left;">
                <th style="padding: 10px;">Event Name</th>
                <th style="padding: 10px;">Date</th>
                <th style="padding: 10px;">Location</th>
                <th style="padding: 10px;">Description</th>
                <th style="padding: 10px;">Action</th>
              </tr>
            </thead>
            <tbody>
              {% for event in upcoming_events %}
              <tr>
                <td style="padding: 10px;">{{ event.event_name }}</td>
                <td style="padding: 10px;">{{ event.event_date }}</td>
                <td style="padding: 10px;">{{ event.location }}</td>
                <td style="padding: 10px;">{{ event.description }}</td>
                <td>
                  <form method="POST" action="{% url 'delete_alumni' %}" style="display: inline;">
                    {% csrf_token %}
                    <input type="hidden" name="event_name" value="{{ event.event_name }}">
                    <button type="submit" class="btn-action delete" title="Delete" onclick="return confirm('Are you sure you want to delete this event? This action cannot be undone.');">
                      <i class="fas fa-trash"></i>
                    </button>
                  </form>
                </td>
              </tr>
              {% empty %}
              <tr>
                <td colspan="5" style="padding: 10px; text-align: center;">No upcoming events available.</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>



         <!-- Careers Section -->
        <div id="careers" class="content-section">
          <div class="section-header">
            <h3>Career Opportunities</h3>
            <div class="section-actions">
              <input type="text" placeholder="Search jobs..." class="search-input">
              <button class="btn-primary" id="btnOpenModalAddJob">
                <i class="fas fa-plus"></i> Post Job
              </button>
            </div>
          </div>
          
          <div class="jobs-table">
            <table class="data-table">
              <thead>
                <tr>
                  <th>Position</th>
                  <th>Company</th>
                  <th>Location</th>
                  <th>Posted Date</th>
                  <th>Applications</th>
                  <th>Status</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>Software Engineer</td>
                  <td>Tech Corp</td>
                  <td>Bangalore</td>
                  <td>2024-03-01</td>
                  <td>45</td>
                  <td><span class="status active">Active</span></td>
                  <td>
                    <button class="btn-action view"><i class="fas fa-eye"></i></button>
                    <button class="btn-action edit"><i class="fas fa-edit"></i></button>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
       <!-- Posts Section -->
      <div id="posts" class="content-section">
        <div class="section-header">
          <h3 class="section-title">Latest Posts</h3>
          <div class="section-actions">
            <button class="btn-primary" id="btnOpenModalAddPost">
              <i class="fas fa-plus"></i> New Post
            </button>
          </div>
        </div>
        
        <div class="posts-list">
          <div class="post-card">
            <h4>Understanding Mental Health Awareness</h4>
            <p class="post-meta">By Admin | March 20, 2024</p>
            <p>Raising awareness about mental health issues and supporting those in need...</p>
            <div class="post-actions">
              <button class="btn-action edit"><i class="fas fa-edit"></i></button>
              <button class="btn-action delete"><i class="fas fa-trash"></i></button>
            </div>
          </div>
          
          <div class="post-card">
            <h4>Tips for Stress Management</h4>
            <p class="post-meta">By Dr. Smith | March 18, 2024</p>
            <p>Practical ways to handle stress and improve mental well-being...</p>
            <div class="post-actions">
              <button class="btn-action edit"><i class="fas fa-edit"></i></button>
              <button class="btn-action delete"><i class="fas fa-trash"></i></button>
            </div>
          </div>
        </div>
      </div>

       <!-- Donation Section -->
        <div id="donation" class="content-section">
          <div class="donation-header">
            <h3 class="section-title">Donation Management</h3>
            <button class="btn-primary btn-donation">
              <i class="fas fa-hand-holding-heart"></i> New Donation
            </button>
          </div>
          
          <div class="donation-summary-cards">
            <div class="summary-card total-donations">
              <div class="card-icon">
                <i class="fas fa-coins"></i>
              </div>
              <div class="card-content">
                <h4>Total Donations</h4>
                <p class="amount">$24,850</p>
                <span class="trend positive"><i class="fas fa-arrow-up"></i> 12% from last month</span>
              </div>
            </div>
            
            <div class="summary-card recent-donors">
              <div class="card-icon">
                <i class="fas fa-users"></i>
              </div>
              <div class="card-content">
                <h4>Recent Donors</h4>
                <div class="donor-list">
                  <div class="donor-item">
                    <div class="donor-info">
                      <span class="donor-name">John Doe</span>
                      <span class="donation-amount">$500</span>
                    </div>
                    <span class="donation-date">Mar 25, 2024</span>
                  </div>
                  <div class="donor-item">
                    <div class="donor-info">
                      <span class="donor-name">Jane Smith</span>
                      <span class="donation-amount">$250</span>
                    </div>
                    <span class="donation-date">Mar 24, 2024</span>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="donation-table-container">
            <div class="table-header">
              <h4>Donation Records</h4>
              <div class="table-controls">
                <input type="text" placeholder="Search donations..." class="search-input">
                <button class="btn-filter"><i class="fas fa-filter"></i> Filter</button>
              </div>
            </div>
            
            <table class="donation-data-table">
              <thead>
                <tr>
                  <th>Donor</th>
                  <th>Amount</th>
                  <th>Date</th>
                  <th>Payment Method</th>
                  <th>Status</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td class="donor-info-cell">
                    <div class="donor-avatar">
                      JD
                    </div>
                    <div class="donor-details">
                      <span class="donor-name">John Doe</span>
                      <span class="donor-email">john@example.com</span>
                    </div>
                  </td>
                  <td class="amount-cell">
                    <span class="donation-amount">$200</span>
                  </td>
                  <td>2024-03-20</td>
                  <td>
                    <span class="payment-method credit-card">
                      <i class="fas fa-credit-card"></i> Card
                    </span>
                  </td>
                  <td>
                    <span class="status-badge completed">
                      <i class="fas fa-check-circle"></i> Completed
                    </span>
                  </td>
                  <td>
                    <div class="action-buttons">
                      <button class="btn-action view"><i class="fas fa-eye"></i></button>
                      <button class="btn-action receipt"><i class="fas fa-receipt"></i></button>
                    </div>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
        <!-- Management Section -->
        <div id="management" class="content-section">
          <div class="section-header">
            <h3>System Administration</h3>
            <div class="section-actions">
              <button class="btn-primary" id="btnOpenModalAddAdmin">
                <i class="fas fa-plus"></i> Add Admin
              </button>
            </div>
          </div>

          <div class="admin-table">
            <table class="data-table">
              <thead>
                <tr>
                  <th>Username</th>
                  <th>Email</th>
                  <th>Role</th>
                  <th>Last Login</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>admin1</td>
                  <td>admin@vitgrad.com</td>
                  <td>Super Admin</td>
                  <td>2024-03-12 14:30</td>
                  <td>
                    <button class="btn-action edit"><i class="fas fa-edit"></i></button>
                    <button class="btn-action delete"><i class="fas fa-trash"></i></button>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </main>
  </div>

  <!-- Add Alumni Modal -->
  <div id="modalAddAlumni" class="modal">
    <div class="modal-content">
      <span class="close">&times;</span>
      <h2>Add Alumni</h2>
      <form id="alumniForm" action="{% url 'add_alumni' %}" method="post" onsubmit="return validateForm()">
        {% csrf_token %}
  
        <div class="form-group">
          <label for="inputFirstName">First Name:</label>
          <input type="text" id="inputFirstName" name="first_name" required pattern="^[A-Za-z\s'-]+$"
            title="Only letters, spaces, hyphens and apostrophes are allowed">
          <small id="firstNameError" class="error-message"></small>
        </div>
  
        <div class="form-group">
          <label for="inputLastName">Last Name:</label>
          <input type="text" id="inputLastName" name="last_name" required pattern="^[A-Za-z\s'-]+$"
            title="Only letters, spaces, hyphens and apostrophes are allowed">
          <small id="lastNameError" class="error-message"></small>
        </div>
  
        <div class="form-group">
          <label for="inputAlumniName">Full Name:</label>
          <input type="text" id="inputAlumniName" name="alumni_name" required pattern="^[A-Za-z\s'-]+$"
            title="Only letters, spaces, hyphens and apostrophes are allowed">
          <small id="alumniNameError" class="error-message"></small>
        </div>
  
        <div class="form-group">
          <label for="inputDOB">Date of Birth:</label>
          <input type="date" id="inputDOB" name="DOB" required>
          <small id="dobError" class="error-message"></small>
        </div>
  
        <div class="form-group">
          <label for="inputAge">Age:</label>
          <input type="number" id="inputAge" name="age" required min="18" max="150"
            title="Age must be between 18 and 150">
          <small id="ageError" class="error-message"></small>
        </div>
  
        <div class="form-group">
          <label for="inputAlumniEmail">Email:</label>
          <input type="email" id="inputAlumniEmail" name="alumni_email" required>
          <small id="emailError" class="error-message"></small>
        </div>
  
        <div class="form-group">
          <label for="inputAlumniPhone">Phone:</label>
          <input type="tel" id="inputAlumniPhone" name="alumni_phone" required pattern="^[0-9]{10,15}$"
            title="Phone number must be 10 to 15 digits">
          <small id="phoneError" class="error-message"></small>
        </div>
  
        <div class="form-group">
          <label for="inputAddress">Full Address:</label>
          <textarea id="inputAddress" name="full_address" required></textarea>
          <small id="addressError" class="error-message"></small>
        </div>
  
        <div class="form-group">
          <label for="inputStreetName">Street Name:</label>
          <input type="text" id="inputStreetName" name="street_name" required>
          <small id="streetNameError" class="error-message"></small>
        </div>
  
        <div class="form-group">
          <label for="inputCity">City:</label>
          <input type="text" id="inputCity" name="city" required>
          <small id="cityError" class="error-message"></small>
        </div>
  
        <div class="form-group">
          <label for="inputPincode">Pincode:</label>
          <input type="text" id="inputPincode" name="pincode" required pattern="^[0-9]{6,10}$"
            title="Pincode must be 6 to 10 digits">
          <small id="pincodeError" class="error-message"></small>
        </div>
  
        <div class="form-group">
          <label for="inputDepartment">Department:</label>
          <select id="inputDepartment" name="department" required>
            <option value="">Select Department</option>
            <option value="Computer Science">Computer Science</option>
            <option value="Electronics">Electronics</option>
            <option value="Mechanical">Mechanical</option>
            <!-- Add more options if needed -->
          </select>
          <small id="departmentError" class="error-message"></small>
        </div>
  
        <div class="form-group">
          <label for="inputGraduationYear">Graduation Year:</label>
          <input type="number" id="inputGraduationYear" name="graduation_year" required min="1950" max="2100">
          <small id="graduationYearError" class="error-message"></small>
        </div>
  
        <button type="submit" class="btn-primary">Submit</button>
      </form>
    </div>
  </div>
  
  <!-- Add Event Modal-->
  
  <div id="modalAddEvent" class="modal">
    <div class="modal-content">
        <span class="close">&times;</span>
        <h2>Add Event</h2>
        <form id="eventForm" action="{% url 'add_event' %}" method="post" onsubmit="return validateEventForm()">
            {% csrf_token %}

            <div class="form-group">
                <label for="inputEventName">Event Name:</label>
                <input type="text" id="inputEventName" name="event_name" required>
                <small id="eventNameError" class="error-message"></small>
            </div>

            <div class="form-group">
                <label for="inputEventDate">Event Date:</label>
                <input type="date" id="inputEventDate" name="event_date" required>
                <small id="eventDateError" class="error-message"></small>
            </div>

            <div class="form-group">
                <label for="inputLocation">Location:</label>
                <input type="text" id="inputLocation" name="location" required>
                <small id="locationError" class="error-message"></small>
            </div>

            <div class="form-group">
                <label for="inputDescription">Description:</label>
                <textarea id="inputDescription" name="description" rows="4"></textarea>
                <small id="descriptionError" class="error-message"></small>
            </div>

            <div class="form-group">
                <label for="inputMaxParticipants">Max Participants:</label>
                <input type="number" id="inputMaxParticipants" name="max_participants" min="0">
                <small id="maxParticipantsError" class="error-message"></small>
            </div>

            <div class="form-group">
                <label for="inputTags">Tags (comma-separated):</label>
                <input type="text" id="inputTags" name="tags">
                <small id="tagsError" class="error-message"></small>
            </div>

            <button type="submit" class="btn-primary">Submit</button>
        </form>
    </div>
  </div>

<style>
  .error-message {
      color: red;
      font-size: 0.8em;
      display: block;
  }
  </style>

  <script>

    window.addEventListener('load', function () {
      const loader = document.getElementById('pageLoader');
      if (loader) loader.style.display = 'none';
    });
  </script>

<script>
  function confirmLogout(event) {
    event.preventDefault();
  
    if (window.confirm('Are you sure you want to logout?')) {
      const loaderOverlay = document.getElementById('loader-overlay');
      const logoutUrl = event.target.dataset.logoutUrl;
  
      loaderOverlay.style.display = 'flex';
  
      setTimeout(function() {
        window.location.href = logoutUrl;
      }, 1000);
    }
  }

  function validateForm() {
    let isValid = true;
    const firstName = document.getElementById('inputFirstName').value;
    const lastName = document.getElementById('inputLastName').value;
    const alumniName = document.getElementById('inputAlumniName').value;
    const dob = document.getElementById('inputDOB').value;
    const age = document.getElementById('inputAge').value;
    const email = document.getElementById('inputAlumniEmail').value;
    const phone = document.getElementById('inputAlumniPhone').value;
    const address = document.getElementById('inputAddress').value;
    const streetName = document.getElementById('inputStreetName').value;
    const city = document.getElementById('inputCity').value;
    const pincode = document.getElementById('inputPincode').value;

    // Clear previous error messages
    document.querySelectorAll('.error-message').forEach(el => el.textContent = '');

    if (!/^[A-Za-z\s'-]+$/.test(firstName)) {
        document.getElementById('firstNameError').textContent = 'Invalid first name format.';
        isValid = false;
    }

    if (!/^[A-Za-z\s'-]+$/.test(lastName)) {
        document.getElementById('lastNameError').textContent = 'Invalid last name format.';
        isValid = false;
    }

    if (!/^[A-Za-z\s'-]+$/.test(alumniName)) {
        document.getElementById('alumniNameError').textContent = 'Invalid full name format.';
        isValid = false;
    }

    if (!dob) {
        document.getElementById('dobError').textContent = 'Date of birth is required.';
        isValid = false;
    }

    if (!age || age < 18 || age > 150) {
        document.getElementById('ageError').textContent = 'Age must be between 18 and 150.';
        isValid = false;
    }

    if (!email || !/\S+@\S+\.\S+/.test(email)) {
        document.getElementById('emailError').textContent = 'Invalid email format.';
        isValid = false;
    }

    if (!phone || !/^[0-9]{10,15}$/.test(phone)) {
        document.getElementById('phoneError').textContent = 'Phone must be 10 to 15 digits.';
        isValid = false;
    }

    if (!address) {
        document.getElementById('addressError').textContent = 'Address is required.';
        isValid = false;
    }

    if (!streetName) {
        document.getElementById('streetNameError').textContent = 'Street name is required.';
        isValid = false;
    }

    if (!city) {
        document.getElementById('cityError').textContent = 'City is required.';
        isValid = false;
    }

    if (!pincode || !/^[0-9]{6,10}$/.test(pincode)) {
        document.getElementById('pincodeError').textContent = 'Pincode must be 6 to 10 digits.';
        isValid = false;
    }

    return isValid;
}

function validateEventForm() {
  let isValid = true;
  const eventName = document.getElementById('inputEventName').value;
  const eventDate = document.getElementById('inputEventDate').value;
  const location = document.getElementById('inputLocation').value;

  document.querySelectorAll('.error-message').forEach(el => el.textContent = '');

  if (!eventName) {
      document.getElementById('eventNameError').textContent = 'Event name is required.';
      isValid = false;
  }

  if (!eventDate) {
      document.getElementById('eventDateError').textContent = 'Event date is required.';
      isValid = false;
  }

  if (!location) {
      document.getElementById('locationError').textContent = 'Location is required.';
      isValid = false;
  }

  return isValid;
}

  // Handle add alumni button click
  document.getElementById('btnOpenModalAddAlumni').addEventListener('click', function() {
    document.getElementById('modalAddAlumni').style.display = 'block';
  });

  // Close modal when clicking on the close button
  document.querySelectorAll('.close').forEach(closeBtn => {
    closeBtn.addEventListener('click', function() {
      this.closest('.modal').style.display = 'none';
    });
  });

  // Close modal when clicking outside of it
  window.addEventListener('click', function(event) {
    if (event.target.classList.contains('modal')) {
      event.target.style.display = 'none';
    }
  });
  
  // Add event listeners
  const modal = document.getElementById('modalEditAlumni');
  const closeBtn = modal.querySelector('.close');
  const form = modal.querySelector('#editAlumniForm');
  
  // Close modal when clicking on the close button
  closeBtn.addEventListener('click', function() {
    modal.remove();
  });
  
  // Close modal when clicking outside of it
  window.addEventListener('click', function(event) {
    if (event.target === modal) {
      modal.remove();
    }
  });
  
  // Handle form submission
  form.addEventListener('submit', function(e) {
    e.preventDefault();
    
    // Validate form
    if (!validateEditForm()) {
      return;
    }
    
    // Show loading state
    const submitBtn = form.querySelector('button[type="submit"]');
    const originalText = submitBtn.textContent;
    submitBtn.textContent = 'Updating...';
    submitBtn.disabled = true;
    
    // Submit the form
    fetch(form.action, {
      method: 'POST',
      body: new FormData(form),
      headers: {
        'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
      }
    })
    .then(response => response.json())
    .then(data => {
      if (data.success) {
        alert('Alumni updated successfully!');
        modal.remove();
        // Refresh the page to show updated data
        window.location.reload();
      } else {
        alert('Error: ' + data.message);
        submitBtn.textContent = originalText;
        submitBtn.disabled = false;
      }
    })
    .catch(error => {
      console.error('Error:', error);
      alert('An error occurred while updating the alumni.');
      submitBtn.textContent = originalText;
      submitBtn.disabled = false;
    });
  });
}

// Function to validate edit form
function validateEditForm() {
  let isValid = true;
  const firstName = document.getElementById('editFirstName').value;
  const lastName = document.getElementById('editLastName').value;
  const alumniName = document.getElementById('editAlumniName').value;
  const dob = document.getElementById('editDOB').value;
  const age = document.getElementById('editAge').value;
  const email = document.getElementById('editAlumniEmail').value;
  const phone = document.getElementById('editAlumniPhone').value;
  const address = document.getElementById('editAddress').value;
  const streetName = document.getElementById('editStreetName').value;
  const city = document.getElementById('editCity').value;
  const pincode = document.getElementById('editPincode').value;

  // Clear previous error messages
  document.querySelectorAll('#modalEditAlumni .error-message').forEach(el => el.textContent = '');

  if (!/^[A-Za-z\s'-]+$/.test(firstName)) {
      document.getElementById('editFirstNameError').textContent = 'Invalid first name format.';
      isValid = false;
  }

  if (!/^[A-Za-z\s'-]+$/.test(lastName)) {
      document.getElementById('editLastNameError').textContent = 'Invalid last name format.';
      isValid = false;
  }

  if (!/^[A-Za-z\s'-]+$/.test(alumniName)) {
      document.getElementById('editAlumniNameError').textContent = 'Invalid full name format.';
      isValid = false;
  }

  if (!dob) {
      document.getElementById('editDOBError').textContent = 'Date of birth is required.';
      isValid = false;
  }

  if (!age || age < 18 || age > 150) {
      document.getElementById('editAgeError').textContent = 'Age must be between 18 and 150.';
      isValid = false;
  }

  if (!email || !/\S+@\S+\.\S+/.test(email)) {
      document.getElementById('editEmailError').textContent = 'Invalid email format.';
      isValid = false;
  }

  if (!phone || !/^[0-9]{10,15}$/.test(phone)) {
      document.getElementById('editPhoneError').textContent = 'Phone must be 10 to 15 digits.';
      isValid = false;
  }

  if (!address) {
      document.getElementById('editAddressError').textContent = 'Address is required.';
      isValid = false;
  }

  if (!streetName) {
      document.getElementById('editStreetNameError').textContent = 'Street name is required.';
      isValid = false;
  }

  if (!city) {
      document.getElementById('editCityError').textContent = 'City is required.';
      isValid = false;
  }

  if (!pincode || !/^[0-9]{6,10}$/.test(pincode)) {
      document.getElementById('editPincodeError').textContent = 'Pincode must be 6 to 10 digits.';
      isValid = false;
  }

  return isValid;
}

// Function to show loading state
function showLoadingState(sectionId) {
  const section = document.getElementById(sectionId);
  if (section) {
    const loadingOverlay = document.createElement('div');
    loadingOverlay.className = 'loading-overlay';
    loadingOverlay.innerHTML = `
      <div class="loading-spinner"></div>
      <p>Loading...</p>
    `;
    section.appendChild(loadingOverlay);
  }
}

// Function to hide loading state
function hideLoadingState(sectionId) {
  const section = document.getElementById(sectionId);
  if (section) {
    const loadingOverlay = section.querySelector('.loading-overlay');
    if (loadingOverlay) {
      loadingOverlay.remove();
    }
  }
}

// Event Management Functions
document.addEventListener('DOMContentLoaded', function() {
  // Handle add event button click
  document.getElementById('btnOpenModalAddEvent').addEventListener('click', function() {
    document.getElementById('modalAddEvent').style.display = 'block';
  });

  // Close modal when clicking on the close button
  document.querySelectorAll('.close').forEach(closeBtn => {
    closeBtn.addEventListener('click', function() {
      this.closest('.modal').style.display = 'none';
    });
  });

  // Close modal when clicking outside of it
  window.addEventListener('click', function(event) {
    if (event.target.classList.contains('modal')) {
      event.target.style.display = 'none';
    }
  });
});

// Post Management Functions
document.addEventListener('DOMContentLoaded', function() {
  // Handle add post button click
  document.getElementById('btnOpenModalAddPost').addEventListener('click', function() {
    showAddPostModal();
  });
});

// Function to show add post modal
function showAddPostModal() {
  // Create modal HTML
  const modalHtml = `
    <div class="modal" id="modalAddPost">
      <div class="modal-content">
        <span class="close">&times;</span>
        <h2>Create New Post</h2>
        <form id="addPostForm" method="POST" action="{% url 'add_post' %}">
          {% csrf_token %}
          
          <div class="form-group">
            <label for="inputTitle">Title:</label>
            <input type="text" id="inputTitle" name="title" required>
            <small id="titleError" class="error-message"></small>
          </div>

          <div class="form-group">
            <label for="inputContent">Content:</label>
            <textarea id="inputContent" name="content" required></textarea>
            <small id="contentError" class="error-message"></small>
          </div>

          <div class="form-group">
            <label for="inputCategory">Category:</label>
            <select id="inputCategory" name="category" required>
              <option value="">Select a category</option>
              <option value="news">News</option>
              <option value="announcement">Announcement</option>
              <option value="event">Event</option>
              <option value="general">General</option>
            </select>
            <small id="categoryError" class="error-message"></small>
          </div>

          <div class="form-group">
            <label for="inputStatus">Status:</label>
            <select id="inputStatus" name="status" required>
              <option value="draft">Draft</option>
              <option value="published">Published</option>
            </select>
            <small id="statusError" class="error-message"></small>
          </div>

          <button type="submit" class="btn-primary">Create Post</button>
        </form>
      </div>
    </div>
  `;
  
  // Add modal to the DOM
  document.body.insertAdjacentHTML('beforeend', modalHtml);
  
  // Show the modal
  document.getElementById('modalAddPost').style.display = 'block';
  
  // Add event listeners
  const modal = document.getElementById('modalAddPost');
  const closeBtn = modal.querySelector('.close');
  const form = modal.querySelector('#addPostForm');
  
  // Close modal when clicking on the close button
  closeBtn.addEventListener('click', function() {
    modal.remove();
  });
  
  // Close modal when clicking outside of it
  window.addEventListener('click', function(event) {
    if (event.target === modal) {
      modal.remove();
    }
  });
  
  // Handle form submission
  form.addEventListener('submit', function(e) {
    e.preventDefault();
    
    // Validate form
    if (!validatePostForm()) {
      return;
    }
    
    // Show loading state
    const submitBtn = form.querySelector('button[type="submit"]');
    const originalText = submitBtn.textContent;
    submitBtn.textContent = 'Creating...';
    submitBtn.disabled = true;
    
    // Submit the form
    fetch(form.action, {
      method: 'POST',
      body: new FormData(form),
      headers: {
        'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
      }
    })
    .then(response => response.json())
    .then(data => {
      if (data.success) {
        alert('Post created successfully!');
        modal.remove();
        // Refresh the page to show updated data
        window.location.reload();
      } else {
        alert('Error: ' + data.message);
        submitBtn.textContent = originalText;
        submitBtn.disabled = false;
      }
    })
    .catch(error => {
      console.error('Error:', error);
      alert('An error occurred while creating the post.');
      submitBtn.textContent = originalText;
      submitBtn.disabled = false;
    });
  });
}

// Function to validate post form
function validatePostForm() {
  let isValid = true;
  const title = document.getElementById('inputTitle').value;
  const content = document.getElementById('inputContent').value;
  const category = document.getElementById('inputCategory').value;
  const status = document.getElementById('inputStatus').value;

  // Clear previous error messages
  document.querySelectorAll('#modalAddPost .error-message').forEach(el => el.textContent = '');

  if (!title) {
      document.getElementById('titleError').textContent = 'Title is required.';
      isValid = false;
  }

  if (!content) {
      document.getElementById('contentError').textContent = 'Content is required.';
      isValid = false;
  }

  if (!category) {
      document.getElementById('categoryError').textContent = 'Category is required.';
      isValid = false;
  }

  if (!status) {
      document.getElementById('statusError').textContent = 'Status is required.';
      isValid = false;
  }

  return isValid;
}


// Function to show edit post modal
function showEditPostModal(post) {
  // Create modal HTML
  const modalHtml = `
    <div class="modal" id="modalEditPost">
      <div class="modal-content">
        <span class="close">&times;</span>
        <h2>Edit Post</h2>
        <form id="editPostForm" method="POST" action="{% url 'edit_post' %}">
          {% csrf_token %}
          <input type="hidden" name="post_id" value="${post.post_id}">
          
          <div class="form-group">
            <label for="editTitle">Title:</label>
            <input type="text" id="editTitle" name="title" value="${post.title}" required>
            <small id="editTitleError" class="error-message"></small>
          </div>

          <div class="form-group">
            <label for="editContent">Content:</label>
            <textarea id="editContent" name="content" required>${post.content}</textarea>
            <small id="editContentError" class="error-message"></small>
          </div>

          <div class="form-group">
            <label for="editCategory">Category:</label>
            <select id="editCategory" name="category" required>
              <option value="">Select a category</option>
              <option value="news" ${post.category === 'news' ? 'selected' : ''}>News</option>
              <option value="announcement" ${post.category === 'announcement' ? 'selected' : ''}>Announcement</option>
              <option value="event" ${post.category === 'event' ? 'selected' : ''}>Event</option>
              <option value="general" ${post.category === 'general' ? 'selected' : ''}>General</option>
            </select>
            <small id="editCategoryError" class="error-message"></small>
          </div>

          <div class="form-group">
            <label for="editStatus">Status:</label>
            <select id="editStatus" name="status" required>
              <option value="draft" ${post.status === 'draft' ? 'selected' : ''}>Draft</option>
              <option value="published" ${post.status === 'published' ? 'selected' : ''}>Published</option>
            </select>
            <small id="editStatusError" class="error-message"></small>
          </div>

          <button type="submit" class="btn-primary">Update Post</button>
        </form>
      </div>
    </div>
  `;
  
  // Add modal to the DOM
  document.body.insertAdjacentHTML('beforeend', modalHtml);
  
  // Show the modal
  document.getElementById('modalEditPost').style.display = 'block';
  
  // Add event listeners
  const modal = document.getElementById('modalEditPost');
  const closeBtn = modal.querySelector('.close');
  const form = modal.querySelector('#editPostForm');
  
  // Close modal when clicking on the close button
  closeBtn.addEventListener('click', function() {
    modal.remove();
  });
  
  // Close modal when clicking outside of it
  window.addEventListener('click', function(event) {
    if (event.target === modal) {
      modal.remove();
    }
  });
  
  // Handle form submission
  form.addEventListener('submit', function(e) {
    e.preventDefault();
    
    // Validate form
    if (!validateEditPostForm()) {
      return;
    }
    
    // Show loading state
    const submitBtn = form.querySelector('button[type="submit"]');
    const originalText = submitBtn.textContent;
    submitBtn.textContent = 'Updating...';
    submitBtn.disabled = true;
    
    // Submit the form
    fetch(form.action, {
      method: 'POST',
      body: new FormData(form),
      headers: {
        'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
      }
    })
    .then(response => response.json())
    .then(data => {
      if (data.success) {
        alert('Post updated successfully!');
        modal.remove();
        // Refresh the page to show updated data
        window.location.reload();
      } else {
        alert('Error: ' + data.message);
        submitBtn.textContent = originalText;
        submitBtn.disabled = false;
      }
    })
    .catch(error => {
      console.error('Error:', error);
      alert('An error occurred while updating the post.');
      submitBtn.textContent = originalText;
      submitBtn.disabled = false;
    });
  });
}

// Function to validate edit post form
function validateEditPostForm() {
  let isValid = true;
  const title = document.getElementById('editTitle').value;
  const content = document.getElementById('editContent').value;
  const category = document.getElementById('editCategory').value;
  const status = document.getElementById('editStatus').value;

  // Clear previous error messages
  document.querySelectorAll('#modalEditPost .error-message').forEach(el => el.textContent = '');

  if (!title) {
      document.getElementById('editTitleError').textContent = 'Title is required.';
      isValid = false;
  }

  if (!content) {
      document.getElementById('editContentError').textContent = 'Content is required.';
      isValid = false;
  }

  if (!category) {
      document.getElementById('editCategoryError').textContent = 'Category is required.';
      isValid = false;
  }

  if (!status) {
      document.getElementById('editStatusError').textContent = 'Status is required.';
      isValid = false;
  }

  return isValid;
}

// Function to show add donation modal
function showAddDonationModal() {
  // Create modal HTML
  const modalHtml = `
    <div class="modal" id="modalAddDonation">
      <div class="modal-content">
        <span class="close">&times;</span>
        <h2>Add New Donation</h2>
        <form id="addDonationForm" method="POST" action="{% url 'add_donation' %}">
          {% csrf_token %}
          
          <div class="form-group">
            <label for="inputDonorName">Donor Name:</label>
            <input type="text" id="inputDonorName" name="donor_name" required>
            <small id="donorNameError" class="error-message"></small>
          </div>

          <div class="form-group">
            <label for="inputDonorEmail">Donor Email:</label>
            <input type="email" id="inputDonorEmail" name="donor_email" required>
            <small id="donorEmailError" class="error-message"></small>
          </div>

          <div class="form-group">
            <label for="inputAmount">Amount:</label>
            <input type="number" id="inputAmount" name="amount" required min="1" step="0.01">
            <small id="amountError" class="error-message"></small>
          </div>

          <div class="form-group">
            <label for="inputPaymentMethod">Payment Method:</label>
            <select id="inputPaymentMethod" name="payment_method" required>
              <option value="">Select a payment method</option>
              <option value="credit_card">Credit Card</option>
              <option value="bank_transfer">Bank Transfer</option>
              <option value="paypal">PayPal</option>
              <option value="cash">Cash</option>
            </select>
            <small id="paymentMethodError" class="error-message"></small>
          </div>

          <div class="form-group">
            <label for="inputNotes">Notes:</label>
            <textarea id="inputNotes" name="notes"></textarea>
            <small id="notesError" class="error-message"></small>
          </div>

          <button type="submit" class="btn-primary">Add Donation</button>
        </form>
      </div>
    </div>
  `;
  
  // Add modal to the DOM
  document.body.insertAdjacentHTML('beforeend', modalHtml);
  
  // Show the modal
  document.getElementById('modalAddDonation').style.display = 'block';
  
  // Add event listeners
  const modal = document.getElementById('modalAddDonation');
  const closeBtn = modal.querySelector('.close');
  const form = modal.querySelector('#addDonationForm');
  
  // Close modal when clicking on the close button
  closeBtn.addEventListener('click', function() {
    modal.remove();
  });
  
  // Close modal when clicking outside of it
  window.addEventListener('click', function(event) {
    if (event.target === modal) {
      modal.remove();
    }
  });
  
  // Handle form submission
  form.addEventListener('submit', function(e) {
    e.preventDefault();
    
    // Validate form
    if (!validateDonationForm()) {
      return;
    }
    
    // Show loading state
    const submitBtn = form.querySelector('button[type="submit"]');
    const originalText = submitBtn.textContent;
    submitBtn.textContent = 'Adding...';
    submitBtn.disabled = true;
    
    // Submit the form
    fetch(form.action, {
      method: 'POST',
      body: new FormData(form),
      headers: {
        'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
      }
    })
    .then(response => response.json())
    .then(data => {
      if (data.success) {
        alert('Donation added successfully!');
        modal.remove();
        // Refresh the page to show updated data
        window.location.reload();
      } else {
        alert('Error: ' + data.message);
        submitBtn.textContent = originalText;
        submitBtn.disabled = false;
      }
    })
    .catch(error => {
      console.error('Error:', error);
      alert('An error occurred while adding the donation.');
      submitBtn.textContent = originalText;
      submitBtn.disabled = false;
    });
  });
}

// Function to validate donation form
function validateDonationForm() {
  let isValid = true;
  const donorName = document.getElementById('inputDonorName').value;
  const donorEmail = document.getElementById('inputDonorEmail').value;
  const amount = document.getElementById('inputAmount').value;
  const paymentMethod = document.getElementById('inputPaymentMethod').value;

  // Clear previous error messages
  document.querySelectorAll('#modalAddDonation .error-message').forEach(el => el.textContent = '');

  if (!donorName) {
      document.getElementById('donorNameError').textContent = 'Donor name is required.';
      isValid = false;
  }

  if (!donorEmail || !/\S+@\S+\.\S+/.test(donorEmail)) {
      document.getElementById('donorEmailError').textContent = 'Valid email is required.';
      isValid = false;
  }

  if (!amount || amount <= 0) {
      document.getElementById('amountError').textContent = 'Amount must be greater than zero.';
      isValid = false;
  }

  if (!paymentMethod) {
      document.getElementById('paymentMethodError').textContent = 'Payment method is required.';
      isValid = false;
  }

  return isValid;
}

// Function to get donation details
function getDonationDetails(donationId) {
  // Show loading state
  showLoadingState('donation');
  
  // Create form data
  const formData = new FormData();
  formData.append('donation_id', donationId);
  
  // Send request to get donation details
  fetch('{% url "get_donation_details" %}', {
    method: 'POST',
    body: formData,
    headers: {
      'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
    }
  })
  .then(response => response.json())
  .then(data => {
    if (data.success) {
      // Show donation details in a modal
      showDonationDetailsModal(data.donation);
    } else {
      alert('Error: ' + data.message);
    }
  })
  .catch(error => {
    console.error('Error:', error);
    alert('An error occurred while fetching donation details.');
  })
  .finally(() => {
    // Hide loading state
    hideLoadingState('donation');
  });
}

// Function to show donation details modal
function showDonationDetailsModal(donation) {
  // Create modal HTML
  const modalHtml = `
    <div class="modal" id="modalDonationDetails">
      <div class="modal-content">
        <span class="close">&times;</span>
        <h2>Donation Details</h2>
        
        <div class="donation-details">
          <div class="detail-row">
            <span class="detail-label">Donor Name:</span>
            <span class="detail-value">${donation.donor_name}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Donor Email:</span>
            <span class="detail-value">${donation.donor_email}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Amount:</span>
            <span class="detail-value">$${donation.amount}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Date:</span>
            <span class="detail-value">${donation.date}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Payment Method:</span>
            <span class="detail-value">${donation.payment_method}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Status:</span>
            <span class="detail-value">${donation.status}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Notes:</span>
            <span class="detail-value">${donation.notes || 'No notes provided'}</span>
          </div>
        </div>
        
        <div class="donation-actions">
          <button class="btn-primary" onclick="generateReceipt(${donation.donation_id})">
            <i class="fas fa-receipt"></i> Generate Receipt
          </button>
          <button class="btn-primary" onclick="editDonation(${donation.donation_id})">
            <i class="fas fa-edit"></i> Edit
          </button>
        </div>
      </div>
    </div>
  `;
  
  // Add modal to the DOM
  document.body.insertAdjacentHTML('beforeend', modalHtml);
  
  // Show the modal
  document.getElementById('modalDonationDetails').style.display = 'block';
  
  // Add event listeners
  const modal = document.getElementById('modalDonationDetails');
  const closeBtn = modal.querySelector('.close');
  
  // Close modal when clicking on the close button
  closeBtn.addEventListener('click', function() {
    modal.remove();
  });
  
  // Close modal when clicking outside of it
  window.addEventListener('click', function(event) {
    if (event.target === modal) {
      modal.remove();
    }
  });
}

// Function to generate receipt
function generateReceipt(donationId) {
  // Show loading state
  showLoadingState('donation');
  
  // Create form data
  const formData = new FormData();
  formData.append('donation_id', donationId);
  
  // Send request to generate receipt
  fetch('{% url "generate_receipt" %}', {
    method: 'POST',
    body: formData,
    headers: {
      'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
    }
  })
  .then(response => {
    if (response.ok) {
      return response.blob();
    }
    throw new Error('Network response was not ok.');
  })
  .then(blob => {
    // Create a link to download the receipt
    const url = window.URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.style.display = 'none';
    a.href = url;
    a.download = `donation_receipt_${donationId}.pdf`;
    document.body.appendChild(a);
    a.click();
    window.URL.revokeObjectURL(url);
    a.remove();
  })
  .catch(error => {
    console.error('Error:', error);
    alert('An error occurred while generating the receipt.');
  })
  .finally(() => {
    // Hide loading state
    hideLoadingState('donation');
  });
}

// Function to edit donation
function editDonation(donationId) {
  // Show loading state
  showLoadingState('donation');
  
  // Create form data
  const formData = new FormData();
  formData.append('donation_id', donationId);
  
  // Send request to get donation details
  fetch('{% url "get_donation_details" %}', {
    method: 'POST',
    body: formData,
    headers: {
      'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
    }
  })
  .then(response => response.json())
  .then(data => {
    if (data.success) {
      // Show edit modal
      showEditDonationModal(data.donation);
    } else {
      alert('Error: ' + data.message);
    }
  })
  .catch(error => {
    console.error('Error:', error);
    alert('An error occurred while fetching donation details.');
  })
  .finally(() => {
    // Hide loading state
    hideLoadingState('donation');
  });
}

// Function to show edit donation modal
function showEditDonationModal(donation) {
  // Create modal HTML
  const modalHtml = `
    <div class="modal" id="modalEditDonation">
      <div class="modal-content">
        <span class="close">&times;</span>
        <h2>Edit Donation</h2>
        <form id="editDonationForm" method="POST" action="{% url 'edit_donation' %}">
          {% csrf_token %}
          <input type="hidden" name="donation_id" value="${donation.donation_id}">
          
          <div class="form-group">
            <label for="editDonorName">Donor Name:</label>
            <input type="text" id="editDonorName" name="donor_name" value="${donation.donor_name}" required>
            <small id="editDonorNameError" class="error-message"></small>
          </div>

          <div class="form-group">
            <label for="editDonorEmail">Donor Email:</label>
            <input type="email" id="editDonorEmail" name="donor_email" value="${donation.donor_email}" required>
            <small id="editDonorEmailError" class="error-message"></small>
          </div>

          <div class="form-group">
            <label for="editAmount">Amount:</label>
            <input type="number" id="editAmount" name="amount" value="${donation.amount}" required min="1" step="0.01">
            <small id="editAmountError" class="error-message"></small>
          </div>

          <div class="form-group">
            <label for="editPaymentMethod">Payment Method:</label>
            <select id="editPaymentMethod" name="payment_method" required>
              <option value="">Select a payment method</option>
              <option value="credit_card" ${donation.payment_method === 'credit_card' ? 'selected' : ''}>Credit Card</option>
              <option value="bank_transfer" ${donation.payment_method === 'bank_transfer' ? 'selected' : ''}>Bank Transfer</option>
              <option value="paypal" ${donation.payment_method === 'paypal' ? 'selected' : ''}>PayPal</option>
              <option value="cash" ${donation.payment_method === 'cash' ? 'selected' : ''}>Cash</option>
            </select>
            <small id="editPaymentMethodError" class="error-message"></small>
          </div>

          <div class="form-group">
            <label for="editStatus">Status:</label>
            <select id="editStatus" name="status" required>
              <option value="pending" ${donation.status === 'pending' ? 'selected' : ''}>Pending</option>
              <option value="completed" ${donation.status === 'completed' ? 'selected' : ''}>Completed</option>
              <option value="cancelled" ${donation.status === 'cancelled' ? 'selected' : ''}>Cancelled</option>
            </select>
            <small id="editStatusError" class="error-message"></small>
          </div>

          <div class="form-group">
            <label for="editNotes">Notes:</label>
            <textarea id="editNotes" name="notes">${donation.notes || ''}</textarea>
            <small id="editNotesError" class="error-message"></small>
          </div>

          <button type="submit" class="btn-primary">Update Donation</button>
        </form>
      </div>
    </div>
  `;
  
  // Add modal to the DOM
  document.body.insertAdjacentHTML('beforeend', modalHtml);
  
  // Show the modal
  document.getElementById('modalEditDonation').style.display = 'block';
  
  // Add event listeners
  const modal = document.getElementById('modalEditDonation');
  const closeBtn = modal.querySelector('.close');
  const form = modal.querySelector('#editDonationForm');
  
  // Close modal when clicking on the close button
  closeBtn.addEventListener('click', function() {
    modal.remove();
  });
  
  // Close modal when clicking outside of it
  window.addEventListener('click', function(event) {
    if (event.target === modal) {
      modal.remove();
    }
  });
  
  // Handle form submission
  form.addEventListener('submit', function(e) {
    e.preventDefault();
    
    // Validate form
    if (!validateEditDonationForm()) {
      return;
    }
    
    // Show loading state
    const submitBtn = form.querySelector('button[type="submit"]');
    const originalText = submitBtn.textContent;
    submitBtn.textContent = 'Updating...';
    submitBtn.disabled = true;
    
    // Submit the form
    fetch(form.action, {
      method: 'POST',
      body: new FormData(form),
      headers: {
        'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
      }
    })
    .then(response => response.json())
    .then(data => {
      if (data.success) {
        alert('Donation updated successfully!');
        modal.remove();
        // Refresh the page to show updated data
        window.location.reload();
      } else {
        alert('Error: ' + data.message);
        submitBtn.textContent = originalText;
        submitBtn.disabled = false;
      }
    })
    .catch(error => {
      console.error('Error:', error);
      alert('An error occurred while updating the donation.');
      submitBtn.textContent = originalText;
      submitBtn.disabled = false;
    });
  });
}

// Function to validate edit donation form
function validateEditDonationForm() {
  let isValid = true;
  const donorName = document.getElementById('editDonorName').value;
  const donorEmail = document.getElementById('editDonorEmail').value;
  const amount = document.getElementById('editAmount').value;
  const paymentMethod = document.getElementById('editPaymentMethod').value;
  const status = document.getElementById('editStatus').value;

  // Clear previous error messages
  document.querySelectorAll('#modalEditDonation .error-message').forEach(el => el.textContent = '');

  if (!donorName) {
      document.getElementById('editDonorNameError').textContent = 'Donor name is required.';
      isValid = false;
  }

  if (!donorEmail || !/\S+@\S+\.\S+/.test(donorEmail)) {
      document.getElementById('editDonorEmailError').textContent = 'Valid email is required.';
      isValid = false;
  }

  if (!amount || amount <= 0) {
      document.getElementById('editAmountError').textContent = 'Amount must be greater than zero.';
      isValid = false;
  }

  if (!paymentMethod) {
      document.getElementById('editPaymentMethodError').textContent = 'Payment method is required.';
      isValid = false;
  }

  if (!status) {
      document.getElementById('editStatusError').textContent = 'Status is required.';
      isValid = false;
  }

  return isValid;
}

// Admin Management Functions
document.addEventListener('DOMContentLoaded', function() {
  // Handle add admin button click
  document.getElementById('btnOpenModalAddAdmin').addEventListener('click', function() {
    showAddAdminModal();
  });

  // Handle edit admin button click
  document.querySelectorAll('.admin-table .btn-action.edit').forEach(button => {
    button.addEventListener('click', function() {
      const adminId = this.closest('tr').getAttribute('data-admin-id');
      getAdminDetails(adminId);
    });
  });

  // Handle delete admin button click
  document.querySelectorAll('.admin-table .btn-action.delete').forEach(button => {
    button.addEventListener('click', function() {
      const adminId = this.closest('tr').getAttribute('data-admin-id');
      confirmDeleteAdmin(adminId);
    });
  });
});

// Function to show add admin modal
function showAddAdminModal() {
  // Create modal HTML
  const modalHtml = `
    <div class="modal" id="modalAddAdmin">
      <div class="modal-content">
        <span class="close">&times;</span>
        <h2>Add New Admin</h2>
        <form id="addAdminForm" method="POST" action="{% url 'add_admin' %}">
          {% csrf_token %}
          
          <div class="form-group">
            <label for="inputUsername">Username:</label>
            <input type="text" id="inputUsername" name="username" required>
            <small id="usernameError" class="error-message"></small>
          </div>

          <div class="form-group">
            <label for="inputEmail">Email:</label>
            <input type="email" id="inputEmail" name="email" required>
            <small id="emailError" class="error-message"></small>
          </div>

          <div class="form-group">
            <label for="inputPassword">Password:</label>
            <input type="password" id="inputPassword" name="password" required>
            <small id="passwordError" class="error-message"></small>
          </div>

          <div class="form-group">
            <label for="inputConfirmPassword">Confirm Password:</label>
            <input type="password" id="inputConfirmPassword" name="confirm_password" required>
            <small id="confirmPasswordError" class="error-message"></small>
          </div>

          <div class="form-group">
            <label for="inputRole">Role:</label>
            <select id="inputRole" name="role" required>
              <option value="">Select a role</option>
              <option value="super_admin">Super Admin</option>
              <option value="admin">Admin</option>
              <option value="moderator">Moderator</option>
            </select>
            <small id="roleError" class="error-message"></small>
          </div>

          <button type="submit" class="btn-primary">Add Admin</button>
        </form>
      </div>
    </div>
  `;
  
  // Add modal to the DOM
  document.body.insertAdjacentHTML('beforeend', modalHtml);
  
  // Show the modal
  document.getElementById('modalAddAdmin').style.display = 'block';
  
  // Add event listeners
  const modal = document.getElementById('modalAddAdmin');
  const closeBtn = modal.querySelector('.close');
  const form = modal.querySelector('#addAdminForm');
  
  // Close modal when clicking on the close button
  closeBtn.addEventListener('click', function() {
    modal.remove();
  });
  
  // Close modal when clicking outside of it
  window.addEventListener('click', function(event) {
    if (event.target === modal) {
      modal.remove();
    }
  });
  
  // Handle form submission
  form.addEventListener('submit', function(e) {
    e.preventDefault();
    
    // Validate form
    if (!validateAdminForm()) {
      return;
    }
    
    // Show loading state
    const submitBtn = form.querySelector('button[type="submit"]');
    const originalText = submitBtn.textContent;
    submitBtn.textContent = 'Adding...';
    submitBtn.disabled = true;
    
    // Submit the form
    fetch(form.action, {
      method: 'POST',
      body: new FormData(form),
      headers: {
        'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
      }
    })
    .then(response => response.json())
    .then(data => {
      if (data.success) {
        alert('Admin added successfully!');
        modal.remove();
        // Refresh the page to show updated data
        window.location.reload();
      } else {
        alert('Error: ' + data.message);
        submitBtn.textContent = originalText;
        submitBtn.disabled = false;
      }
    })
    .catch(error => {
      console.error('Error:', error);
      alert('An error occurred while adding the admin.');
      submitBtn.textContent = originalText;
      submitBtn.disabled = false;
    });
  });
}

// Function to validate admin form
function validateAdminForm() {
  let isValid = true;
  const username = document.getElementById('inputUsername').value;
  const email = document.getElementById('inputEmail').value;
  const password = document.getElementById('inputPassword').value;
  const confirmPassword = document.getElementById('inputConfirmPassword').value;
  const role = document.getElementById('inputRole').value;

  // Clear previous error messages
  document.querySelectorAll('#modalAddAdmin .error-message').forEach(el => el.textContent = '');

  if (!username) {
      document.getElementById('usernameError').textContent = 'Username is required.';
      isValid = false;
  }

  if (!email || !/\S+@\S+\.\S+/.test(email)) {
      document.getElementById('emailError').textContent = 'Valid email is required.';
      isValid = false;
  }

  if (!password) {
      document.getElementById('passwordError').textContent = 'Password is required.';
      isValid = false;
  } else if (password.length < 8) {
      document.getElementById('passwordError').textContent = 'Password must be at least 8 characters.';
      isValid = false;
  }

  if (password !== confirmPassword) {
      document.getElementById('confirmPasswordError').textContent = 'Passwords do not match.';
      isValid = false;
  }

  if (!role) {
      document.getElementById('roleError').textContent = 'Role is required.';
      isValid = false;
  }

  return isValid;
}

// Function to get admin details
function getAdminDetails(adminId) {
  // Show loading state
  showLoadingState('management');
  
  // Create form data
  const formData = new FormData();
  formData.append('admin_id', adminId);
  
  // Send request to get admin details
  fetch('{% url "get_admin_details" %}', {
    method: 'POST',
    body: formData,
    headers: {
      'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
    }
  })
  .then(response => response.json())
  .then(data => {
    if (data.success) {
      // Show edit modal
      showEditAdminModal(data.admin);
    } else {
      alert('Error: ' + data.message);
    }
  })
  .catch(error => {
    console.error('Error:', error);
    alert('An error occurred while fetching admin details.');
  })
  .finally(() => {
    // Hide loading state
    hideLoadingState('management');
  });
}

// Function to show edit admin modal
function showEditAdminModal(admin) {
  // Create modal HTML
  const modalHtml = `
    <div class="modal" id="modalEditAdmin">
      <div class="modal-content">
        <span class="close">&times;</span>
        <h2>Edit Admin</h2>
        <form id="editAdminForm" method="POST" action="{% url 'edit_admin' %}">
          {% csrf_token %}
          <input type="hidden" name="admin_id" value="${admin.admin_id}">
          
          <div class="form-group">
            <label for="editUsername">Username:</label>
            <input type="text" id="editUsername" name="username" value="${admin.username}" required>
            <small id="editUsernameError" class="error-message"></small>
          </div>

          <div class="form-group">
            <label for="editEmail">Email:</label>
            <input type="email" id="editEmail" name="email" value="${admin.email}" required>
            <small id="editEmailError" class="error-message"></small>
          </div>

          <div class="form-group">
            <label for="editRole">Role:</label>
            <select id="editRole" name="role" required>
              <option value="">Select a role</option>
              <option value="super_admin" ${admin.role === 'super_admin' ? 'selected' : ''}>Super Admin</option>
              <option value="admin" ${admin.role === 'admin' ? 'selected' : ''}>Admin</option>
              <option value="moderator" ${admin.role === 'moderator' ? 'selected' : ''}>Moderator</option>
            </select>
            <small id="editRoleError" class="error-message"></small>
          </div>

          <div class="form-group">
            <label for="editPassword">New Password (leave blank to keep current):</label>
            <input type="password" id="editPassword" name="password">
            <small id="editPasswordError" class="error-message"></small>
          </div>

          <div class="form-group">
            <label for="editConfirmPassword">Confirm New Password:</label>
            <input type="password" id="editConfirmPassword" name="confirm_password">
            <small id="editConfirmPasswordError" class="error-message"></small>
          </div>

          <button type="submit" class="btn-primary">Update Admin</button>
        </form>
      </div>
    </div>
  `;
  
  // Add modal to the DOM
  document.body.insertAdjacentHTML('beforeend', modalHtml);
  
  // Show the modal
  document.getElementById('modalEditAdmin').style.display = 'block';
  
  // Add event listeners
  const modal = document.getElementById('modalEditAdmin');
  const closeBtn = modal.querySelector('.close');
  const form = modal.querySelector('#editAdminForm');
  
  // Close modal when clicking on the close button
  closeBtn.addEventListener('click', function() {
    modal.remove();
  });
  
  // Close modal when clicking outside of it
  window.addEventListener('click', function(event) {
    if (event.target === modal) {
      modal.remove();
    }
  });
  
  // Handle form submission
  form.addEventListener('submit', function(e) {
    e.preventDefault();
    
    // Validate form
    if (!validateEditAdminForm()) {
      return;
    }
    
    // Show loading state
    const submitBtn = form.querySelector('button[type="submit"]');
    const originalText = submitBtn.textContent;
    submitBtn.textContent = 'Updating...';
    submitBtn.disabled = true;
    
    // Submit the form
    fetch(form.action, {
      method: 'POST',
      body: new FormData(form),
      headers: {
        'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
      }
    })
    .then(response => response.json())
    .then(data => {
      if (data.success) {
        alert('Admin updated successfully!');
        modal.remove();
        // Refresh the page to show updated data
        window.location.reload();
      } else {
        alert('Error: ' + data.message);
        submitBtn.textContent = originalText;
        submitBtn.disabled = false;
      }
    })
    .catch(error => {
      console.error('Error:', error);
      alert('An error occurred while updating the admin.');
      submitBtn.textContent = originalText;
      submitBtn.disabled = false;
    });
  });
}

// Function to validate edit admin form
function validateEditAdminForm() {
  let isValid = true;
  const username = document.getElementById('editUsername').value;
  const email = document.getElementById('editEmail').value;
  const role = document.getElementById('editRole').value;
  const password = document.getElementById('editPassword').value;
  const confirmPassword = document.getElementById('editConfirmPassword').value;

  // Clear previous error messages
  document.querySelectorAll('#modalEditAdmin .error-message').forEach(el => el.textContent = '');

  if (!username) {
      document.getElementById('editUsernameError').textContent = 'Username is required.';
      isValid = false;
  }

  if (!email || !/\S+@\S+\.\S+/.test(email)) {
      document.getElementById('editEmailError').textContent = 'Valid email is required.';
      isValid = false;
  }

  if (!role) {
      document.getElementById('editRoleError').textContent = 'Role is required.';
      isValid = false;
  }

  // Only validate password if it's being changed
  if (password) {
    if (password.length < 8) {
        document.getElementById('editPasswordError').textContent = 'Password must be at least 8 characters.';
        isValid = false;
    }

    if (password !== confirmPassword) {
        document.getElementById('editConfirmPasswordError').textContent = 'Passwords do not match.';
        isValid = false;
    }
  }

  return isValid;
}

// Function to confirm delete admin
function confirmDeleteAdmin(adminId) {
  if (confirm('Are you sure you want to delete this admin? This action cannot be undone.')) {
    // Show loading state
    showLoadingState('management');
    
    // Create form data
    const formData = new FormData();
    formData.append('admin_id', adminId);
    
    // Send request to delete admin
    fetch('{% url "delete_admin" %}', {
      method: 'POST',
      body: formData,
      headers: {
        'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
      }
    })
    .then(response => response.json())
    .then(data => {
      if (data.success) {
        alert('Admin deleted successfully!');
        // Refresh the page to show updated data
        window.location.reload();
      } else {
        alert('Error: ' + data.message);
      }
    })
    .catch(error => {
      console.error('Error:', error);
      alert('An error occurred while deleting the admin.');
    })
    .finally(() => {
      // Hide loading state
      hideLoadingState('management');
    });
  }
}

// Career Management Functions
document.addEventListener('DOMContentLoaded', function() {
  // Handle add job button click
  document.getElementById('btnOpenModalAddJob').addEventListener('click', function() {
    showAddJobModal();
  });

  // Handle edit job button click
  document.querySelectorAll('.jobs-table .btn-action.edit').forEach(button => {
    button.addEventListener('click', function() {
      const jobId = this.closest('tr').getAttribute('data-job-id');
      getJobDetails(jobId);
    });
  });

  // Handle delete job button click
  document.querySelectorAll('.jobs-table .btn-action.delete').forEach(button => {
    button.addEventListener('click', function() {
      const jobId = this.closest('tr').getAttribute('data-job-id');
      confirmDeleteJob(jobId);
    });
  });
});

// Function to show add job modal
function showAddJobModal() {
  // Create modal HTML
  const modalHtml = `
    <div class="modal" id="modalAddJob">
      <div class="modal-content">
        <span class="close">&times;</span>
        <h2>Post New Job</h2>
        <form id="addJobForm" method="POST" action="{% url 'add_job' %}">
          {% csrf_token %}
          
          <div class="form-group">
            <label for="inputPosition">Position:</label>
            <input type="text" id="inputPosition" name="position" required>
            <small id="positionError" class="error-message"></small>
          </div>

          <div class="form-group">
            <label for="inputCompany">Company:</label>
            <input type="text" id="inputCompany" name="company" required>
            <small id="companyError" class="error-message"></small>
          </div>

          <div class="form-group">
            <label for="inputLocation">Location:</label>
            <input type="text" id="inputLocation" name="location" required>
            <small id="locationError" class="error-message"></small>
          </div>

          <div class="form-group">
            <label for="inputJobType">Job Type:</label>
            <select id="inputJobType" name="job_type" required>
              <option value="">Select job type</option>
              <option value="full_time">Full Time</option>
              <option value="part_time">Part Time</option>
              <option value="contract">Contract</option>
              <option value="internship">Internship</option>
            </select>
            <small id="jobTypeError" class="error-message"></small>
          </div>

          <div class="form-group">
            <label for="inputDescription">Job Description:</label>
            <textarea id="inputDescription" name="description" required></textarea>
            <small id="descriptionError" class="error-message"></small>
          </div>

          <div class="form-group">
            <label for="inputRequirements">Requirements:</label>
            <textarea id="inputRequirements" name="requirements" required></textarea>
            <small id="requirementsError" class="error-message"></small>
          </div>

          <div class="form-group">
            <label for="inputSalary">Salary Range:</label>
            <input type="text" id="inputSalary" name="salary" placeholder="e.g. $50,000 - $70,000">
            <small id="salaryError" class="error-message"></small>
          </div>

          <div class="form-group">
            <label for="inputApplicationDeadline">Application Deadline:</label>
            <input type="date" id="inputApplicationDeadline" name="application_deadline" required>
            <small id="applicationDeadlineError" class="error-message"></small>
          </div>

          <div class="form-group">
            <label for="inputContactEmail">Contact Email:</label>
            <input type="email" id="inputContactEmail" name="contact_email" required>
            <small id="contactEmailError" class="error-message"></small>
          </div>

          <button type="submit" class="btn-primary">Post Job</button>
        </form>
      </div>
    </div>
  `;
  
  // Add modal to the DOM
  document.body.insertAdjacentHTML('beforeend', modalHtml);
  
  // Show the modal
  document.getElementById('modalAddJob').style.display = 'block';
  
  // Add event listeners
  const modal = document.getElementById('modalAddJob');
  const closeBtn = modal.querySelector('.close');
  const form = modal.querySelector('#addJobForm');
  
  // Close modal when clicking on the close button
  closeBtn.addEventListener('click', function() {
    modal.remove();
  });
  
  // Close modal when clicking outside of it
  window.addEventListener('click', function(event) {
    if (event.target === modal) {
      modal.remove();
    }
  });
  
  // Handle form submission
  form.addEventListener('submit', function(e) {
    e.preventDefault();
    
    // Validate form
    if (!validateJobForm()) {
      return;
    }
    
    // Show loading state
    const submitBtn = form.querySelector('button[type="submit"]');
    const originalText = submitBtn.textContent;
    submitBtn.textContent = 'Posting...';
    submitBtn.disabled = true;
    
    // Submit the form
    fetch(form.action, {
      method: 'POST',
      body: new FormData(form),
      headers: {
        'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
      }
    })
    .then(response => response.json())
    .then(data => {
      if (data.success) {
        alert('Job posted successfully!');
        modal.remove();
        // Refresh the page to show updated data
        window.location.reload();
      } else {
        alert('Error: ' + data.message);
        submitBtn.textContent = originalText;
        submitBtn.disabled = false;
      }
    })
    .catch(error => {
      console.error('Error:', error);
      alert('An error occurred while posting the job.');
      submitBtn.textContent = originalText;
      submitBtn.disabled = false;
    });
  });
}

// Function to validate job form
function validateJobForm() {
  let isValid = true;
  const position = document.getElementById('inputPosition').value;
  const company = document.getElementById('inputCompany').value;
  const location = document.getElementById('inputLocation').value;
  const jobType = document.getElementById('inputJobType').value;
  const description = document.getElementById('inputDescription').value;
  const requirements = document.getElementById('inputRequirements').value;
  const applicationDeadline = document.getElementById('inputApplicationDeadline').value;
  const contactEmail = document.getElementById('inputContactEmail').value;

  // Clear previous error messages
  document.querySelectorAll('#modalAddJob .error-message').forEach(el => el.textContent = '');

  if (!position) {
      document.getElementById('positionError').textContent = 'Position is required.';
      isValid = false;
  }

  if (!company) {
      document.getElementById('companyError').textContent = 'Company is required.';
      isValid = false;
  }

  if (!location) {
      document.getElementById('locationError').textContent = 'Location is required.';
      isValid = false;
  }

  if (!jobType) {
      document.getElementById('jobTypeError').textContent = 'Job type is required.';
      isValid = false;
  }

  if (!description) {
      document.getElementById('descriptionError').textContent = 'Job description is required.';
      isValid = false;
  }

  if (!requirements) {
      document.getElementById('requirementsError').textContent = 'Requirements are required.';
      isValid = false;
  }

  if (!applicationDeadline) {
      document.getElementById('applicationDeadlineError').textContent = 'Application deadline is required.';
      isValid = false;
  }

  if (!contactEmail || !/\S+@\S+\.\S+/.test(contactEmail)) {
      document.getElementById('contactEmailError').textContent = 'Valid contact email is required.';
      isValid = false;
  }

  return isValid;
}

// Function to get job details
function getJobDetails(jobId) {
  // Show loading state
  showLoadingState('careers');
  
  // Create form data
  const formData = new FormData();
  formData.append('job_id', jobId);
  
  // Send request to get job details
  fetch('{% url "get_job_details" %}', {
    method: 'POST',
    body: formData,
    headers: {
      'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
    }
  })
  .then(response => response.json())
  .then(data => {
    if (data.success) {
      // Show edit modal
      showEditJobModal(data.job);
    } else {
      alert('Error: ' + data.message);
    }
  })
  .catch(error => {
    console.error('Error:', error);
    alert('An error occurred while fetching job details.');
  })
  .finally(() => {
    // Hide loading state
    hideLoadingState('careers');
  });
}

// Function to show edit job modal
function showEditJobModal(job) {
  // Create modal HTML
  const modalHtml = `
    <div class="modal" id="modalEditJob">
      <div class="modal-content">
        <span class="close">&times;</span>
        <h2>Edit Job</h2>
        <form id="editJobForm" method="POST" action="{% url 'edit_job' %}">
          {% csrf_token %}
          <input type="hidden" name="job_id" value="${job.job_id}">
          
          <div class="form-group">
            <label for="editPosition">Position:</label>
            <input type="text" id="editPosition" name="position" value="${job.position}" required>
            <small id="editPositionError" class="error-message"></small>
          </div>

          <div class="form-group">
            <label for="editCompany">Company:</label>
            <input type="text" id="editCompany" name="company" value="${job.company}" required>
            <small id="editCompanyError" class="error-message"></small>
          </div>

          <div class="form-group">
            <label for="editLocation">Location:</label>
            <input type="text" id="editLocation" name="location" value="${job.location}" required>
            <small id="editLocationError" class="error-message"></small>
          </div>

          <div class="form-group">
            <label for="editJobType">Job Type:</label>
            <select id="editJobType" name="job_type" required>
              <option value="">Select job type</option>
              <option value="full_time" ${job.job_type === 'full_time' ? 'selected' : ''}>Full Time</option>
              <option value="part_time" ${job.job_type === 'part_time' ? 'selected' : ''}>Part Time</option>
              <option value="contract" ${job.job_type === 'contract' ? 'selected' : ''}>Contract</option>
              <option value="internship" ${job.job_type === 'internship' ? 'selected' : ''}>Internship</option>
            </select>
            <small id="editJobTypeError" class="error-message"></small>
          </div>

          <div class="form-group">
            <label for="editDescription">Job Description:</label>
            <textarea id="editDescription" name="description" required>${job.description}</textarea>
            <small id="editDescriptionError" class="error-message"></small>
          </div>

          <div class="form-group">
            <label for="editRequirements">Requirements:</label>
            <textarea id="editRequirements" name="requirements" required>${job.requirements}</textarea>
            <small id="editRequirementsError" class="error-message"></small>
          </div>

          <div class="form-group">
            <label for="editSalary">Salary Range:</label>
            <input type="text" id="editSalary" name="salary" value="${job.salary || ''}" placeholder="e.g. $50,000 - $70,000">
            <small id="editSalaryError" class="error-message"></small>
          </div>

          <div class="form-group">
            <label for="editApplicationDeadline">Application Deadline:</label>
            <input type="date" id="editApplicationDeadline" name="application_deadline" value="${job.application_deadline}" required>
            <small id="editApplicationDeadlineError" class="error-message"></small>
          </div>

          <div class="form-group">
            <label for="editContactEmail">Contact Email:</label>
            <input type="email" id="editContactEmail" name="contact_email" value="${job.contact_email}" required>
            <small id="editContactEmailError" class="error-message"></small>
          </div>

          <div class="form-group">
            <label for="editStatus">Status:</label>
            <select id="editStatus" name="status" required>
              <option value="active" ${job.status === 'active' ? 'selected' : ''}>Active</option>
              <option value="closed" ${job.status === 'closed' ? 'selected' : ''}>Closed</option>
              <option value="draft" ${job.status === 'draft' ? 'selected' : ''}>Draft</option>
            </select>
            <small id="editStatusError" class="error-message"></small>
          </div>

          <button type="submit" class="btn-primary">Update Job</button>
        </form>
      </div>
    </div>
  `;
  
  // Add modal to the DOM
  document.body.insertAdjacentHTML('beforeend', modalHtml);
  
  // Show the modal
  document.getElementById('modalEditJob').style.display = 'block';
  
  // Add event listeners
  const modal = document.getElementById('modalEditJob');
  const closeBtn = modal.querySelector('.close');
  const form = modal.querySelector('#editJobForm');
  
  // Close modal when clicking on the close button
  closeBtn.addEventListener('click', function() {
    modal.remove();
  });
  
  // Close modal when clicking outside of it
  window.addEventListener('click', function(event) {
    if (event.target === modal) {
      modal.remove();
    }
  });
  
  // Handle form submission
  form.addEventListener('submit', function(e) {
    e.preventDefault();
    
    // Validate form
    if (!validateEditJobForm()) {
      return;
    }
    
    // Show loading state
    const submitBtn = form.querySelector('button[type="submit"]');
    const originalText = submitBtn.textContent;
    submitBtn.textContent = 'Updating...';
    submitBtn.disabled = true;
    
    // Submit the form
    fetch(form.action, {
      method: 'POST',
      body: new FormData(form),
      headers: {
        'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
      }
    })
    .then(response => response.json())
    .then(data => {
      if (data.success) {
        alert('Job updated successfully!');
        modal.remove();
        // Refresh the page to show updated data
        window.location.reload();
      } else {
        alert('Error: ' + data.message);
        submitBtn.textContent = originalText;
        submitBtn.disabled = false;
      }
    })
    .catch(error => {
      console.error('Error:', error);
      alert('An error occurred while updating the job.');
      submitBtn.textContent = originalText;
      submitBtn.disabled = false;
    });
  });
}

// Function to validate edit job form
function validateEditJobForm() {
  let isValid = true;
  const position = document.getElementById('editPosition').value;
  const company = document.getElementById('editCompany').value;
  const location = document.getElementById('editLocation').value;
  const jobType = document.getElementById('editJobType').value;
  const description = document.getElementById('editDescription').value;
  const requirements = document.getElementById('editRequirements').value;
  const applicationDeadline = document.getElementById('editApplicationDeadline').value;
  const contactEmail = document.getElementById('editContactEmail').value;
  const status = document.getElementById('editStatus').value;

  // Clear previous error messages
  document.querySelectorAll('#modalEditJob .error-message').forEach(el => el.textContent = '');

  if (!position) {
      document.getElementById('editPositionError').textContent = 'Position is required.';
      isValid = false;
  }

  if (!company) {
      document.getElementById('editCompanyError').textContent = 'Company is required.';
      isValid = false;
  }

  if (!location) {
      document.getElementById('editLocationError').textContent = 'Location is required.';
      isValid = false;
  }

  if (!jobType) {
      document.getElementById('editJobTypeError').textContent = 'Job type is required.';
      isValid = false;
  }

  if (!description) {
      document.getElementById('editDescriptionError').textContent = 'Job description is required.';
      isValid = false;
  }

  if (!requirements) {
      document.getElementById('editRequirementsError').textContent = 'Requirements are required.';
      isValid = false;
  }

  if (!applicationDeadline) {
      document.getElementById('editApplicationDeadlineError').textContent = 'Application deadline is required.';
      isValid = false;
  }

  if (!contactEmail || !/\S+@\S+\.\S+/.test(contactEmail)) {
      document.getElementById('editContactEmailError').textContent = 'Valid contact email is required.';
      isValid = false;
  }

  if (!status) {
      document.getElementById('editStatusError').textContent = 'Status is required.';
      isValid = false;
  }

  return isValid;
}

// Function to confirm delete job
function confirmDeleteJob(jobId) {
  if (confirm('Are you sure you want to delete this job posting? This action cannot be undone.')) {
    // Show loading state
    showLoadingState('careers');
    
    // Create form data
    const formData = new FormData();
    formData.append('job_id', jobId);
    
    // Send request to delete job
    fetch('{% url "delete_job" %}', {
      method: 'POST',
      body: formData,
      headers: {
        'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
      }
    })
    .then(response => response.json())
    .then(data => {
      if (data.success) {
        alert('Job deleted successfully!');
        // Refresh the page to show updated data
        window.location.reload();
      } else {
        alert('Error: ' + data.message);
      }
    })
    .catch(error => {
      console.error('Error:', error);
      alert('An error occurred while deleting the job.');
    })
    .finally(() => {
      // Hide loading state
      hideLoadingState('careers');
    });
  }
}

</script>
  
<script src="{% static 'js/script.js' %}"></script>

</body>
</html>
