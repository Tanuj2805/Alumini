{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Dashboard - VITGrad</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <link rel="stylesheet" href="{% static 'css/style.css' %}">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  {% comment %} <script src="{% static 'js/careers.js' %}"></script> {% endcomment %}
  <style>
    /* Base Styles */
    body.dashboard-body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background: #f3f4f6;
    }
    .dashboard-wrapper {
      display: flex;
      min-height: 100vh;
    }
    .dashboard-sidebar {
      width: 280px;
      background: white;
      box-shadow: 2px 0 10px rgba(0,0,0,0.1);
    }
    .sidebar-header {
      padding: 1.5rem;
      display: flex;
      align-items: center;
      border-bottom: 1px solid #e5e7eb;
    }
    .logo-img {
      height: 50px;
      margin-right: 10px;
    }
    .sidebar-nav ul {
      list-style: none;
      padding: 1rem;
    }
    .sidebar-nav li a {
      display: flex;
      align-items: center;
      padding: 0.75rem 1rem;
      border-radius: 8px;
      color: #64748b;
      text-decoration: none;
      transition: all 0.2s;
    }
    .sidebar-nav li a:hover, .sidebar-nav li a.active {
      background: #2563eb;
      color: white;
    }
    .dashboard-main {
      flex: 1;
      overflow-x: hidden;
    }
    .dashboard-header {
      background: white;
      padding: 1rem 2rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    .btn-logout {
      color: #dc2626;
      text-decoration: none;
    }
    .content-section {
      display: none;
      padding: 2rem;
    }
    .content-section.active {
      display: block;
    }
    .cards-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 1.5rem;
      margin-bottom: 2rem;
    }
    .card {
      background: white;
      border-radius: 10px;
      padding: 1.5rem;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    .charts-container {
      display: flex;
      gap: 0.5rem;
      justify-content: space-between;
      flex-wrap: wrap;
    }
    .chart-card {
      width: 40%;
      background: white;
      padding: 50px;
      border-radius: 10px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    canvas {
      height: 200px !important;
    }
    .user-profile {
      position: relative;
      display: inline-block;
    }
    .profile-pic {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      cursor: pointer;
    }
    .profile-dropdown {
      display: none;
      position: absolute;
      right: 0;
      background: white;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      padding: 1rem;
      min-width: 200px;
      z-index: 1000;
    }
    .profile-dropdown.show { display: block; }
    .modal {
      display: none;
      position: fixed;
      z-index: 1001;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      overflow: auto;
      background-color: rgba(0,0,0,0.4);
    }
    
    .modal-content {
      background-color: #fff;
      margin: 5% auto;
      padding: 20px;
      border-radius: 8px;
      width: 50%;
      max-width: 600px;
    }
    
    .close {
      color: #aaa;
      float: right;
      font-size: 28px;
      font-weight: bold;
      cursor: pointer;
    }
    
    .form-group {
      margin-bottom: 1rem;
    }
    
    .form-group label {
      display: block;
      margin-bottom: 0.5rem;
    }
    
    .form-group input,
    .form-group textarea {
      width: 100%;
      padding: 0.5rem;
      border: 1px solid #ddd;
      border-radius: 4px;
    }
    .loader-wrapper {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.8); /* Semi-transparent black background */
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 9999; /* Ensure the loader appears on top of other content */
  }
  
  .loader {
      border: 8px solid #ffffff; /* White */
      border-top: 8px solid #3498db; /* Blue */
      border-radius: 50%;
      width: 50px;
      height: 50px;
      animation: spin 1s linear infinite; /* Apply the rotation animation */
  }
  
  @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
  }

  .posts-section {
      flex: 1;
      overflow-y: auto;
      background: #ffffff;
      border-radius: 15px;
      padding: 2rem;
      box-shadow: 0 8px 30px rgba(0,0,0,0.12);
  }

  .posts-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 2rem;
      padding-bottom: 1.5rem;
      border-bottom: 2px solid #f0f2f5;
  }

  .btn-new-post {
      background: linear-gradient(135deg, #2563eb, #1d4ed8);
      color: white;
      padding: 0.8rem 1.5rem;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      transition: transform 0.2s;
  }

  .btn-new-post:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
  }

  /* Post Components */
  .posts-grid {
      display: grid;
      gap: 2rem;
  }

  .post-card {
      background: #ffffff;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
      transition: transform 0.2s, box-shadow 0.2s;
      overflow: hidden;
  }

  .post-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 20px rgba(0,0,0,0.12);
  }

  .post-author {
      display: flex;
      align-items: center;
      padding: 1.5rem;
      background: linear-gradient(90deg, #f8fafc, #ffffff);
      border-bottom: 1px solid #f1f5f9;
  }

  .post-avatar {
      width: 45px;
      height: 45px;
      border-radius: 50%;
      margin-right: 1rem;
      border: 2px solid #ffffff;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
  }

  .author-info h4 {
      margin: 0;
      font-size: 1.1rem;
      color: #1e293b;
  }

  .post-time {
      color: #64748b;
      font-size: 0.9rem;
      margin: 0;
  }

  .post-content {
      padding: 1.5rem;
      position: relative;
  }

  .post-text {
      color: #334155;
      line-height: 1.6;
      margin-bottom: 1rem;
      font-size: 1rem;
  }

  .post-image {
      width: 100%;
      border-radius: 8px;
      margin-top: 1rem;
      transition: transform 0.3s;
      cursor: zoom-in;
  }

  .post-image:hover {
      transform: scale(1.02);
  }

  .post-actions {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1rem 1.5rem;
      background: #f8fafc;
      border-top: 1px solid #f1f5f9;
  }

  .posts-scroll-container {
      max-height: 70vh; /* Adjust based on your layout */
      overflow-y: auto;
      padding-right: 0.5rem;
      margin-top: 1rem;
  }

  /* Optional: smooth scrollbar styling */
  .posts-scroll-container::-webkit-scrollbar {
      width: 8px;
  }

  .posts-scroll-container::-webkit-scrollbar-thumb {
      background-color: #cbd5e1;
      border-radius: 10px;
  }

  .posts-scroll-container::-webkit-scrollbar-thumb:hover {
      background-color: #94a3b8;
  }

  {% comment %} invitations styles {% endcomment %}
   
  
  </style>
</head>
<body class="dashboard-body">
  <div class="dashboard-wrapper">
    <aside class="dashboard-sidebar">
      <div class="sidebar-header">
        <img src="{% static 'images/vit_logo.webp' %}" alt="VITGrad Logo" class="logo-img">
        <h1 class="logo">VITGrad</h1>
      </div>
      <nav class="sidebar-nav">
        <ul>
          <li><a href="#dashboard" class="active">Dashboard</a></li>
          <li><a href="#alumni">Alumni</a></li>
          <li><a href="#events">Events</a></li>
          {% comment %} <li><a href="#careers">Careers</a></li> {% endcomment %}
          <li><a href="#posts">Posts</a></li>
          <li><a href="#donation">Donation</a></li>
          <li><a href="#management">Student</a></li>
        </ul>
      </nav>
    </aside>
    <main class="dashboard-main">
      <header class="dashboard-header">
        <h2>Admin Dashboard</h2>
        <div class="user-profile">
          <img src="{% static 'images/avatar.png' %}" alt="Profile" class="profile-pic">
          <div class="profile-dropdown">
            <p>Logged in as: <strong>Admin</strong></p>
          </div>
        </div>
        <a href="#" class="btn-logout" data-logout-url="{% url 'logout' %}" onclick="confirmLogout(event)">
          <i class="fas fa-sign-out-alt"></i> Logout
        </a>
      </header>
      <div class="dashboard-content">

        <div id="loader-overlay" style="display: none;">
          <div id="loader">Logging out...</div>
        </div>

        <div class="loader-wrapper">
          <div class="loader"></div>
      </div>
            
        <!-- Dashboard Section -->
      <div id="dashboard" class="content-section active">
        <div class="cards-grid">
          <!-- Dynamic cards will be inserted here -->
        </div>
      </div>


        <!-- Alumni Section -->
        <div id="alumni" class="content-section">
            <div class="section-header" style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap;">
            <h3>Alumni Management</h3>
            <div class="alumni-actions" style="display: flex; gap: 10px; flex-wrap: wrap; align-items: center;">
                <!-- Search Box -->
                   <input type="text" id="alumniSearch" name="search" placeholder="Search alumni..." value="{{ search_query }}" style="padding: 0.5rem; border: 1px solid #e5e7eb; border-radius: 5px;">
                    <!-- Action Buttons -->
                    <button type="submit" class="btn-primary">
                        <i class="fas fa-search"></i> Search
                    </button>
                    <button class="btn-primary" id="btnOpenModalAddAlumni">
                      <i class="fas fa-plus"></i> Add Alumni
                    </button>
            </div>
            </div>
            <div class="table-container">
                <div class="table-info">
                    <p>Showing {{ alumni_data.start_index }} to {{ alumni_data.end_index }} of {{ total_alumni }} alumni</p>
                </div>
                <table class="data-table" id="alumniTable">
                    <thead>
                        <tr>
                            <th>Full Name</th>
                            <th>Date of Birth</th>
                            <th>Age</th>
                            <th>Email</th>
                            <th>Phone</th>
                            <th>Address</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for alumni in alumni_data %}
                            <tr>
                                <td>{{ alumni.alumni_name }}</td>
                                <td>{{ alumni.DOB }}</td>
                                <td>{{ alumni.age }}</td>
                                <td>{{ alumni.alumni_email }}</td>
                                <td>{{ alumni.alumni_phone }}</td>
                                <td>{{ alumni.address }}</td>
                                <td>
                                  <form method="POST" action="{% url 'delete_alumni' %}" style="display: inline;">
                                    {% csrf_token %}
                                    <input type="hidden" name="alumni_email" value="{{ alumni.alumni_email }}">
                                    <button type="submit" class="btn-action delete" title="Delete" onclick="confirmDeleteAlumni({{ alumni.alumni_email }})">
                                      <i class="fas fa-trash"></i>
                                    </button>
                                  </form>
                                </td>
                              
                            </tr>
                        {% empty %}
                            <tr>
                                <td colspan="12">No alumni data available.</td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
                
                <!-- Pagination -->
                {% if alumni_data.has_other_pages %}
                <div class="pagination">
                    <ul class="pagination-list">
                        {% if alumni_data.has_previous %}
                            <li><a href="?page={{ alumni_data.previous_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}{% if sort_by %}&sort={{ sort_by }}{% endif %}" class="pagination-link">&laquo; Previous</a></li>
                        {% else %}
                            <li class="disabled"><span class="pagination-link">&laquo; Previous</span></li>
                        {% endif %}
                        
                        {% for i in alumni_data.paginator.page_range %}
                            {% if alumni_data.number == i %}
                                <li class="active"><span class="pagination-link">{{ i }}</span></li>
                            {% else %}
                                <li><a href="?page={{ i }}{% if search_query %}&search={{ search_query }}{% endif %}{% if sort_by %}&sort={{ sort_by }}{% endif %}" class="pagination-link">{{ i }}</a></li>
                            {% endif %}
                        {% endfor %}
                        
                        {% if alumni_data.has_next %}
                            <li><a href="?page={{ alumni_data.next_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}{% if sort_by %}&sort={{ sort_by }}{% endif %}" class="pagination-link">Next &raquo;</a></li>
                        {% else %}
                            <li class="disabled"><span class="pagination-link">Next &raquo;</span></li>
                        {% endif %}
                    </ul>
                </div>
                {% endif %}
            </div>
        </div>
  
        <!-- Events Section -->
        <div id="events" class="content-section">
          <div class="section-header" style="display: flex; justify-content: space-between; align-items: center;">
            <h3>Events Management</h3>
            <div style="display: flex; gap: 10px;">
              <button class="btn-primary" id="btnViewAttendees">
                <i class="fas fa-users"></i> View Attendees
              </button>
              <button class="btn-primary" id="btnOpenModalAddEvent">
                <i class="fas fa-plus"></i> New Event
              </button>
            </div>
          </div>

          <div class="table-container" style="margin-top: 20px;">
            <table class="data-table" style="width: 100%; border-collapse: collapse;">
              <thead>
                <tr style="background-color: #f3f4f6; text-align: left;">
                  <th style="padding: 10px;">Event Name</th>
                  <th style="padding: 10px;">Date</th>
                  <th style="padding: 10px;">Location</th>
                  <th style="padding: 10px;">Description</th>
                  <th style="padding: 10px;">Invited</th>
                  <th style="padding: 10px;">Actions</th>
                </tr>
              </thead>
              <tbody>
                {% for event in upcoming_events %}
                <tr>
                  <td style="padding: 10px;">{{ event.event_name }}</td>
                  <td style="padding: 10px;">{{ event.event_date|date:"M d, Y" }}</td>
                  <td style="padding: 10px;">{{ event.location }}</td>
                  <td style="padding: 10px;">{{ event.description|truncatechars:50 }}</td>
                  <td style="padding: 10px;">{{ event.invited_alumni.count }}</td>
                  <td style="padding: 10px; white-space: nowrap;">
                    <button class="btn-action invite" title="Invite Alumni" 
                        onclick="openInviteModal('{{ event.event_id }}', '{{ event.event_name }}')">
                        <i class="fas fa-user-plus"></i>
                    </button>
                    <form method="POST" action="{% url 'delete_event' %}" style="display: inline;">
                      {% csrf_token %}
                      <input type="hidden" name="event_id" value="{{ event.event_id }}">
                      <button type="submit" class="btn-action delete" title="Delete" 
                              onclick="return confirm('Are you sure you want to delete this event? This action cannot be undone.');">
                          <i class="fas fa-trash"></i>
                      </button>
                    </form>                            
                  </td>
                </tr>
                {% empty %}
                <tr>
                  <td colspan="6" style="padding: 10px; text-align: center;">No upcoming events available.</td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>

<!-- Invite Alumni Modal -->
<div id="inviteAlumniModal" class="modal">
  <div class="modal-content" style="max-width: 600px;">
    <button class="close" onclick="closeInviteModal()" style="background: none; border: none; font-size: 24px; cursor: pointer;">&times;</button>
      <h3 id="inviteModalTitle">Invite Alumni to Event</h3>
      <div class="search-box" style="margin-bottom: 15px;">
          <input type="text" id="alumniSearch" placeholder="Search alumni..." style="width: 100%; padding: 8px;">
      </div>
      <div class="alumni-list" style="max-height: 400px; overflow-y: auto;">
        {% for alumni in alumni_data %}
        {% if alumni.alumni_id in already_invited_ids %}
          <div class="alumni-item" style="padding: 10px; border-bottom: 1px solid #eee; display: flex; align-items: center; opacity: 0.5;">
              <input type="checkbox" disabled style="margin-right: 10px;">
              <img src="{{ alumni.avatar.url }}" style="width: 40px; height: 40px; border-radius: 50%; margin-right: 10px;">
              <div>
                  <div style="font-weight: bold;">{{ alumni.alumni_name }} (Already Invited)</div>
                  <div style="font-size: 0.9em; color: #666;">{{ alumni.alumni_email }}</div>
              </div>
          </div>
        {% else %}
          <div class="alumni-item" style="padding: 10px; border-bottom: 1px solid #eee; display: flex; align-items: center;">
              <input type="checkbox" name="alumni_ids" value="{{ alumni.alumni_id }}" style="margin-right: 10px;">
              
              {% if alumni.avatar %}
              <img src="{{ alumni.avatar.url }}" style="width: 40px; height: 40px; border-radius: 50%; margin-right: 10px;">
              {% else %}
                <img src="{% static 'images/avatar.png' %}" alt="User" class="post-avatar">
              {% endif %}
              <div>
                  <div style="font-weight: bold;">{{ alumni.alumni_name }}</div>
                  <div style="font-size: 0.9em; color: #666;">{{ alumni.alumni_email }}</div>
              </div>
          </div>
        {% endif %}
      {% endfor %}
      </div>
      <div style="margin-top: 15px; display: flex; justify-content: space-between;">
          <button class="btn-secondary" onclick="selectAllAlumni()">Select All</button>
          <button class="btn-primary" onclick="sendInvitations()">Send Invitations</button>
      </div>
  </div>
</div>


              
      <!-- Attendees Modal -->
      <div id="attendeesModal" class="modal">
        <div class="modal-content" style="max-width: 800px;">
          <span class="close" onclick="closeModal('attendeesModal')">&times;</span>
          <h2>Event Attendees</h2>
          
          <div style="margin-bottom: 20px; display: flex; justify-content: space-between;">
            <div>
              <label for="eventSelect">Select Event:</label>
              <select id="eventSelect" onchange="filterAttendees(this.value)" style="padding: 5px; margin-left: 10px;">
                <option value="">-- All Events --</option>
                {% for event in upcoming_events %}
                <option value="{{ event.event_id }}">{{ event.event_name }} ({{ event.event_date|date:"M d, Y" }})</option>
                {% endfor %}
              </select>
            </div>
            
            <div>
              <label for="sortSelect">Sort By:</label>
              <select id="sortSelect" onchange="sortAttendees(this.value)" style="padding: 5px; margin-left: 10px;">
                <option value="name_asc">Name (A-Z)</option>
                <option value="name_desc">Name (Z-A)</option>
                <option value="date_asc">Date (Oldest)</option>
                <option value="date_desc">Date (Recent)</option>
                <option value="status">Status</option>
              </select>
            </div>
          </div>
          
          <div class="attendees-list-container" style="max-height: 400px; overflow-y: auto;">
            <table style="width: 100%; border-collapse: collapse;">
              <thead>
                <tr style="background-color: #f3f4f6;">
                  <th style="padding: 10px; text-align: left;">Name</th>
                  <th style="padding: 10px; text-align: left;">Email</th>
                  <th style="padding: 10px; text-align: left;">Status</th>
                  <th style="padding: 10px; text-align: left;">Response Date</th>
                </tr>
              </thead>
              <tbody id="attendeesTableBody">
                {% for invitation in invitations %}
                <tr data-event-id="{{ invitation.event.event_id }}" class="attendee-row">
                  <td style="padding: 10px; border-bottom: 1px solid #eee;">{{ invitation.alumni.alumni_name }}</td>
                  <td style="padding: 10px; border-bottom: 1px solid #eee;">{{ invitation.alumni.alumni_email }}</td>
                  <td style="padding: 10px; border-bottom: 1px solid #eee;">
                    <span class="status-badge {{ invitation.status|lower }}">
                      {{ invitation.get_status_display }}
                    </span>
                  </td>
                  <td style="padding: 10px; border-bottom: 1px solid #eee;">
                    {% if invitation.responded_at %}
                      {{ invitation.responded_at|date:"M d, Y" }}
                    {% else %}
                      Not responded
                    {% endif %}
                  </td>
                </tr>
                {% empty %}
                <tr>
                  <td colspan="4" style="padding: 10px; text-align: center;">No invitations found.</td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
      </div>
      


         <!-- Careers Section -->
        <div id="careers" class="content-section">
          <div class="section-header">
            <h3>Career Opportunities</h3>
            <div class="section-actions">
              <input type="text" placeholder="Search jobs..." class="search-input">
              <button class="btn-primary" id="btnOpenModalAddJob">
                <i class="fas fa-plus"></i> Post Job
              </button>
            </div>
          </div>
          
          <div class="jobs-table">
            <table class="data-table">
              <thead>
                <tr>
                  <th>Position</th>
                  <th>Company</th>
                  <th>Location</th>
                  <th>Posted Date</th>
                  <th>Applications</th>
                  <th>Status</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                {% for job in jobs %}
                <tr>
                  <td>{{ job.position }}</td>
                  <td>{{ job.company }}</td>
                  <td>{{ job.location }}</td>
                  <td>{{ job.posted_at|date:"Y-m-d" }}</td>
                  <td>{{ job.application_set.count }}</td>  <!-- Assuming related_name or ForeignKey reverse -->
                  <td>
                    <span class="status {% if job.status == 'active' %}active{% else %}inactive{% endif %}">
                      {{ job.status|capfirst }}
                    </span>
                  </td>
                  <td>
                    <form method="POST" action="{% url 'delete_job' %}" style="display:inline;">
                      {% csrf_token %}
                      <input type="hidden" name="job_id" value="{{ job.id }}">
                      <input type="hidden" name="position" value="{{ job.position }}">
                      <input type="hidden" name="company" value="{{ job.company }}">
                      <button type="submit" class="btn-action delete" onclick="return confirm('Are you sure you want to delete this job?');">
                        <i class="fas fa-trash"></i>
                      </button>
                    </form>
                  </td>
                </tr>
                {% empty %}
                <tr>
                  <td colspan="7" style="text-align: center;">No jobs posted yet.</td>
                </tr>
                {% endfor %}
              </tbody>
            </table>            
          </div>
        </div>
       <!-- Posts Section -->
       <div id="posts" class="content-section">
        <div class="section-header">
            <h3 class="section-title">Latest Posts</h3>
            <div class="section-actions">
                <button class="btn-primary" onclick="showPostModal()">
                    <i class="fas fa-plus"></i> New Post
                </button>
            </div>
        </div>
        
        <div class="posts-scroll-container">
            <div class="posts-grid">
              {% for post in posts %}
              <div class="post-card" data-post-id="{{ post.post_id }}">
                <div class="post-author">
                  {% if post.avatar %}
                    <img src="{{ post.avatar.url }}" alt="User" class="post-avatar">
                  {% else %}
                    <img src="{% static 'images/avatar.png' %}" alt="User" class="post-avatar">
                  {% endif %}
                  <div class="author-info">
                    <h4>{{ post.author_name }}</h4>
                    <p class="post-time">{{ post.created_at|timesince }} ago · <i class="fas fa-globe-asia"></i></p>
                  </div>
                  <button class="btn-action"><i class="fas fa-ellipsis-h"></i></button>
                </div>
                
                <div class="post-content">
                  <p class="post-text">{{ post.content }}</p>
                  
                  {% if post.image %}
                    <img src="{{ post.image.url }}" class="post-image" alt="Post image">
                  {% endif %}

                  <div class="post-tags">
                    <span class="post-tag">#Alumni</span>
                    <span class="post-tag">#Post</span>
                  </div>
                </div>

                <div class="post-actions">
                  <div class="action-group">
                    <button class="btn-action like-btn">
                      <i class="fas fa-thumbs-up"></i> Like
                    </button>
                    <button class="btn-action">
                      <i class="fas fa-comment-alt"></i> Comment
                    </button>
                    <button class="btn-action share-btn" data-post-url="https://yourdomain.com/post/{{ post.post_id }}">
                      <i class="fas fa-share"></i> Share
                    </button>
                  </div>
                </div>

                <!-- Comment Section -->
                <div class="post-comments">
                  <div class="existing-comments" id="comments-{{ post.post_id }}">
                    <!-- New comments will appear here -->
                  </div>
                  <div class="add-comment">
                    <input type="text" class="comment-input" placeholder="Write a comment..." data-post-id="{{ post.post_id }}">
                    <button class="btn-comment" data-post-id="{{ post.post_id }}">
                      <i class="fas fa-paper-plane"></i>
                    </button>
                  </div>
                </div>
              </div>
            {% empty %}
              <p>No posts to show.</p>
            {% endfor %}
      
            </div>
        </div>
    </div>
    

      <!-- Donation Section -->
<div id="donation" class="content-section">
  <div class="donation-header">
    <h3 class="section-title">Donation Management</h3>
  </div>

  <div class="donation-summary-cards">
    <div class="summary-card total-donations">
      <div class="card-icon">
        <i class="fas fa-coins"></i>
      </div>
      <div class="card-content">
        <h4>Total Donations</h4>
        <p class="amount">{{ donation_stats.total_donations }}</p>
      </div>
    </div>

    <div class="summary-card recent-donors">
      <div class="card-icon">
        <i class="fas fa-users"></i>
      </div>
      <div class="card-content">
        <h4>Recent Donors</h4>
        <div class="donor-list">
          {% for donation in recent_donations %}
            <div class="donor-item">
              <div class="donor-info">
                <span class="donor-name">{{ donation.name }}</span>
                <span class="donation-amount">${{ donation.amount }}</span>
              </div>
              <span class="donation-date">{{ donation.date|date:"M d, Y" }}</span>
            </div>
          {% empty %}
            <p class="no-donations">No recent donations yet.</p>
          {% endfor %}
        </div>
      </div>
    </div>
  </div>

  <div class="donation-table-container">
    <div class="table-header">
      <h4>Donation Records</h4>
      <div class="table-controls">
        <input type="text" placeholder="Search donations..." class="search-input" id="donationSearchInput" onkeyup="filterDonations()">
        <button class="btn-filter"><i class="fas fa-filter"></i> Filter</button>
      </div>
    </div>

    <table class="donation-data-table" id="donationTable">
      <thead>
        <tr>
          <th>Donor</th>
          <th>Amount</th>
          <th>Date</th>
          <th>Payment Method</th>
          <th>Status</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for donation in donations %}
          <tr>
            <td class="donor-info-cell">
              <div class="donor-avatar">
                {{ donation.donor.alumni_name|default:"??"|slice:":1" }}
              </div>
              <div class="donor-details">
                <span class="donor-name">{{ donation.donor.alumni_name }}</span>
                <span class="donor-email">{{ donation.donor.alumni_email|default:"-" }}</span>
              </div>
            </td>
            <td class="amount-cell">
              <span class="donation-amount">${{ donation.amount }}</span>
            </td>
            <td>{{ donation.date }}</td>
            <td>
              <span class="payment-method {{ donation.payment_method }}">
                {% if donation.payment_method == 'card' %}
                  <i class="fas fa-credit-card"></i> Card
                {% elif donation.payment_method == 'cash' %}
                  <i class="fas fa-money-bill-wave"></i> Cash
                {% elif donation.payment_method == 'upi' %}
                  <i class="fas fa-mobile-alt"></i> UPI
                {% elif donation.payment_method == 'bank_transfer' %}
                  <i class="fas fa-university"></i> Bank
                {% else %}
                  Unknown
                {% endif %}
              </span>
            </td>
            <td>
              <span class="status-badge {{ donation.status }}">
                {% if donation.status == 'completed' %}
                  <i class="fas fa-check-circle"></i> Completed
                {% elif donation.status == 'pending' %}
                  <i class="fas fa-hourglass-half"></i> Pending
                {% elif donation.status == 'failed' %}
                  <i class="fas fa-times-circle"></i> Failed
                {% endif %}
              </span>
            </td>
            <td>
              <div class="action-buttons">
                <button class="btn-action view" title="View Details"><i class="fas fa-eye"></i></button>
                <button class="btn-action receipt" title="Generate Receipt"><i class="fas fa-receipt"></i></button>
              </div>
            </td>
          </tr>
        {% empty %}
          <tr>
            <td colspan="6" style="text-align: center;">No donations found.</td>
          </tr>
        {% endfor %}

        {% if donations %}
          <tr class="total-row">
            <td colspan="6" style="text-align: right; font-weight: bold; padding-top: 10px;">
              Total Donations: <span style="color: #28a745;">${{ total_donations }}</span>
            </td>
          </tr>
        {% endif %}
      </tbody>
    </table>
  </div>
</div>
        <!-- Management Section -->
        <div id="management" class="content-section">
          <div class="section-header" style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap;">
            <h3>Student Login Management</h3>
            <div class="student-actions" style="display: flex; gap: 10px; flex-wrap: wrap; align-items: center;">
              <!-- Add Student Button -->
              <button class="btn-primary" id="btnOpenModalAddStudent">
                <i class="fas fa-plus"></i> Add Student
              </button>              
            </div>
          </div>
        
          <div class="admin-table">
            <table class="data-table">
              <thead>
                <tr>
                  <th>Username</th>
                  <th>Name</th>
                  <th>Department</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                {% for student in student_logins %}
                <tr>
                  <td>{{ student.username }}</td>
                  <td>{{ student.name }}</td>
                  <td>{{ student.dept }}</td>
                  <td>
                    <button class="btn-action edit" title="Edit"><i class="fas fa-edit"></i></button>
                    <form method="POST" action="{% url 'delete_student' %}" style="display: inline;">
                      {% csrf_token %}
                      <input type="hidden" name="username" value="{{ student.username }}">
                      <button type="submit" class="btn-action delete" title="Delete" onclick="return confirm('Are you sure you want to delete this student?')">
                        <i class="fas fa-trash"></i>
                      </button>
                    </form>
                  </td>
                </tr>
                {% empty %}
                <tr>
                  <td colspan="4">No student login records found.</td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
      </div>
    </main>
  </div>

  
  <!-- Add Alumni Modal -->
  <div id="modalAddAlumni" class="modal">
    <div class="modal-content" style="position: relative; padding: 20px; background: #fff; width: 90%; max-width: 600px; margin: 100px auto; border-radius: 8px;">
      <span class="close" id="closeModalBtn" style="position: absolute; right: 20px; top: 10px; cursor: pointer; font-size: 28px;">&times;</span>
      <h2>Add Alumni</h2>
      <form id="alumniForm" action="{% url 'add_alumni' %}" method="post" enctype="multipart/form-data">
        {% csrf_token %}
  
        <div class="form-group">
          <label for="inputAlumniName">Full Name:</label>
          <input type="text" id="inputAlumniName" name="alumni_name" 
                 required pattern="^[A-Za-z\s'-]+$" 
                 title="Only letters, spaces, hyphens, and apostrophes allowed">
        </div>
  
        <div class="form-group">
          <label>Add Image (Optional)</label>
          <input type="file" id="inputAvatar" name="avatar" accept="image/*">
        </div>
  
        <div class="form-group">
          <label for="inputDOB">Date of Birth:</label>
          <input type="date" id="inputDOB" name="DOB" required max="{{ now|date:'Y-m-d' }}">
        </div>
  
        <div class="form-group">
          <label for="inputAlumniEmail">Email:</label>
          <input type="email" id="inputAlumniEmail" name="alumni_email" required>
        </div>
  
        <div class="form-group">
          <label for="inputAlumniPhone">Phone:</label>
          <input type="tel" id="inputAlumniPhone" name="alumni_phone" required 
                 pattern="^[0-9]{10,15}$" 
                 title="Phone number must be 10 to 15 digits (numbers only)">
        </div>
  
        <div class="form-group">
          <label for="inputAddress">Full Address:</label>
          <textarea id="inputAddress" name="full_address" required minlength="10"
                    title="Please enter at least 10 characters"></textarea>
        </div>
  
        <div class="form-group">
          <label for="inputDepartment">Department:</label>
          <select id="inputDepartment" name="department" required>
            <option value="">Select Department</option>
            <option value="Computer Science">Computer Science</option>
            <option value="Electronics">Electronics</option>
            <option value="Mechanical">Mechanical</option>
          </select>
        </div>
  
        <div class="form-group">
          <label for="inputGraduationYear">Graduation Year:</label>
          <input type="number" id="inputGraduationYear" name="graduation_year" 
                 required min="1950" max="2100" 
                 title="Enter a valid year between 1950 and 2100">
        </div>
  
        <button type="submit" class="btn-primary">Submit</button>
      </form>
    </div>
  </div>

  <!-- Add Student Modal -->
<div id="modalAddStudent" class="modal" style="display: none;">
  <div class="modal-content">
    <span class="close">&times;</span>
    <h2>Add Student</h2>
    <form id="studentForm" action="{% url 'add_student' %}" method="post">
      {% csrf_token %}
      <div class="form-group">
        <label for="username">Username (numeric):</label>
        <input type="number" name="username" required>
      </div>
      <div class="form-group">
        <label for="password">Password:</label>
        <input type="password" name="password" required>
      </div>
      <div class="form-group">
        <label for="name">Full Name:</label>
        <input type="text" name="name" required>
      </div>
      <div class="form-group">
        <label for="dept">Department:</label>
        <input type="text" name="dept" required>
      </div>
      <button type="submit" class="btn-primary">Submit</button>
    </form>
  </div>
</div>

    <!-- Add Event Modal -->
  <div id="modalAddEvent" class="modal">
    <div class="modal-content">
      <span class="close">&times;</span>
      <h2>Add Event</h2>
      <form id="eventForm" action="{% url 'add_event' %}" method="post" enctype="multipart/form-data" novalidate>
        {% csrf_token %}

        <div class="form-group">
          <label for="inputEventName">Event Name:</label>
          <input type="text" id="inputEventName" name="event_name" required
                pattern="^[A-Za-z0-9\s,'-]{3,100}$"
                title="Event name must be 3–100 characters long and can include letters, numbers, commas, apostrophes, and hyphens.">
        </div>

        <div class="form-group">
          <label for="inputEventDate">Event Date:</label>
          <input type="date" id="inputEventDate" name="event_date" required min="{{ today|date:'Y-m-d' }}">
        </div>

        <div class="form-group">
          <label for="inputLocation">Location:</label>
          <input type="text" id="inputLocation" name="location" required
                minlength="3" maxlength="100"
                pattern="^[A-Za-z0-9\s,'-]+$"
                title="Location must be between 3–100 characters and contain valid characters.">
        </div>

        <div class="form-group">
          <label for="inputDescription">Description:</label>
          <textarea id="inputDescription" name="description" rows="4" required
                    minlength="10" maxlength="1000"
                    title="Description must be 10–1000 characters."></textarea>
        </div>

        <div class="form-group">
          <label for="inputMaxParticipants">Max Participants:</label>
          <input type="number" id="inputMaxParticipants" name="max_participants"
                required min="1" max="10000"
                title="Must be a number between 1 and 10,000">
        </div>

        <div class="form-group">
          <label for="inputTags">Tags (comma-separated):</label>
          <input type="text" id="inputTags" name="tags"
                pattern="^[A-Za-z\s,]+$"
                title="Tags must be comma-separated words (letters and spaces only)">
        </div>

        <button type="submit" class="btn-primary">Submit</button>
      </form>
    </div>
  </div>


  <div id="modalAddJob" class="modal">
    <div class="modal-content">
      <span class="close">&times;</span>
      <h2>Add Job</h2>
      <form id="jobForm">
        {% csrf_token %}
        <div class="form-group"><label>Position:</label><input type="text" name="position" required></div>
        <div class="form-group"><label>Company:</label><input type="text" name="company" required></div>
        <div class="form-group"><label>Location:</label><input type="text" name="location" required></div>
        <div class="form-group">
          <label>Job Type:</label>
          <select name="job_type" required>
            <option value="full_time">Full Time</option>
            <option value="part_time">Part Time</option>
            <option value="contract">Contract</option>
            <option value="internship">Internship</option>
          </select>
        </div>
        <div class="form-group"><label>Description:</label><textarea name="description" required></textarea></div>
        <div class="form-group"><label>Requirements:</label><textarea name="requirements" required></textarea></div>
        <div class="form-group"><label>Salary Range (e.g. 30000 - 50000):</label><input type="text" name="salary"></div>
        <div class="form-group"><label>Skills (comma separated):</label><input type="text" name="skills_required"></div>
        <div class="form-group"><label>Application Deadline:</label><input type="date" name="application_deadline" required></div>
        <div class="form-group"><label>Contact Email:</label><input type="email" name="contact_email" required></div>
        <input type="hidden" name="status" value="open">
        <button type="submit">Submit</button>
      </form>
    </div>
  </div>

  {% comment %} post modal {% endcomment %}
  <div id="postModal" class="modal">
    <div class="modal-content">
        <span class="close">&times;</span>
        <h2>Create New Post</h2>
        <form id="postForm" method="POST" action="{% url 'create_post_admin' %}" enctype="multipart/form-data">
            {% csrf_token %}
            <div class="form-scroll-container">
                <div class="form-group">
                    <label>Post Content <span class="required">*</span></label>
                    <textarea name="content" rows="4" required></textarea>
                </div>
                <div class="form-group">
                    <label>Add Image (Optional)</label>
                    <input type="file" name="image" accept="image/*">
                </div>
            </div>
            <div class="form-actions">
                <button type="submit" class="btn-primary">Publish Post</button>
            </div>
        </form>
    </div>
</div>
  
<style>
  /* Modal styles */
.modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0,0,0,0.5);
}

.modal-content {
    background-color: #fff;
    margin: 5% auto;
    padding: 20px;
    border-radius: 5px;
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
}

.close {
    color: #aaa;
    float: right;
    font-size: 28px;
    font-weight: bold;
    cursor: pointer;
}

.close:hover {
    color: black;
}

/* Button styles */
.btn-action {
    border: none;
    background: none;
    cursor: pointer;
    padding: 5px;
    margin: 0 2px;
    font-size: 16px;
}

.btn-action.invite {
    color: #4CAF50;
}

.btn-action.delete {
    color: #f44336;
}

.btn-action:hover {
    opacity: 0.8;
}

.btn-primary {
    background-color: #4CAF50;
    color: white;
    border: none;
    padding: 8px 16px;
    border-radius: 4px;
    cursor: pointer;
}

.btn-secondary {
    background-color: #f0f0f0;
    color: #333;
    border: none;
    padding: 8px 16px;
    border-radius: 4px;
    cursor: pointer;
}

  .error-message {
      color: red;
      font-size: 0.8em;
      display: block;
  }
  </style>

  <script>
    // Function to filter attendees by event
    function filterAttendees(eventId) {
      const rows = document.querySelectorAll('.attendee-row');
      
      rows.forEach(row => {
        if (!eventId || row.getAttribute('data-event-id') === eventId) {
          row.style.display = '';
        } else {
          row.style.display = 'none';
        }
      });
    }
    
    // Function to sort attendees
    function sortAttendees(sortOption) {
      const tbody = document.getElementById('attendeesTableBody');
      const rows = Array.from(tbody.querySelectorAll('.attendee-row:not([style*="display: none"])'));
      
      rows.sort((a, b) => {
        const aName = a.cells[0].textContent.toLowerCase();
        const bName = b.cells[0].textContent.toLowerCase();
        const aStatus = a.cells[2].textContent.toLowerCase();
        const bStatus = b.cells[2].textContent.toLowerCase();
        const aDate = a.cells[3].textContent === 'Not responded' ? new Date(0) : new Date(a.cells[3].textContent);
        const bDate = b.cells[3].textContent === 'Not responded' ? new Date(0) : new Date(b.cells[3].textContent);
        
        switch(sortOption) {
          case 'name_asc': return aName.localeCompare(bName);
          case 'name_desc': return bName.localeCompare(aName);
          case 'date_asc': return aDate - bDate;
          case 'date_desc': return bDate - aDate;
          case 'status': return aStatus.localeCompare(bStatus);
          default: return 0;
        }
      });
      
      // Re-append sorted rows
      rows.forEach(row => tbody.appendChild(row));
    }
    
    // Close modal
    function closeModal(modalId) {
      document.getElementById(modalId).style.display = 'none';
    }
    
    // Close modal when clicking outside
    window.onclick = function(event) {
      if (event.target.className === 'modal') {
        event.target.style.display = 'none';
      }
    }
    
    // Open attendees modal
    document.getElementById('btnViewAttendees').addEventListener('click', function() {
      document.getElementById('attendeesModal').style.display = 'block';
    });
    </script>

    <script>
      function filterDonations() {
        const input = document.getElementById('donationSearchInput');
        const filter = input.value.toLowerCase();
        const table = document.getElementById('donationTable');
        const rows = table.getElementsByTagName('tr');
    
        for (let i = 1; i < rows.length; i++) {
          let cells = rows[i].getElementsByTagName('td');
          let match = false;
          for (let j = 0; j < cells.length; j++) {
            if (cells[j].textContent.toLowerCase().includes(filter)) {
              match = true;
              break;
            }
          }
          rows[i].style.display = match ? '' : 'none';
        }
      }
    </script>

<style>

  
/* Add these styles to your existing CSS */
.status-badge {
  padding: 3px 8px;
  border-radius: 12px;
  font-size: 0.8em;
  font-weight: 500;
}

.status-badge.attending {
  background-color: #d1fae5;
  color: #065f46;
}

.status-badge.not-attending {
  background-color: #fee2e2;
  color: #b91c1c;
}

.status-badge.pending {
  background-color: #fef3c7;
  color: #92400e;
}

.modal {
  display: none;
  position: fixed;
  z-index: 1000;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0,0,0,0.5);
}

.modal-content {
  background-color: #fff;
  margin: 5% auto;
  padding: 20px;
  border-radius: 8px;
  box-shadow: 0 4px 8px rgba(0,0,0,0.1);
}

.close {
  color: #aaa;
  float: right;
  font-size: 28px;
  font-weight: bold;
  cursor: pointer;
}

.close:hover {
  color: black;
}

select {
  border: 1px solid #ddd;
  border-radius: 4px;
  padding: 5px 10px;
}
.counter {
  font-size: 2rem;
  font-weight: bold;
  color: #2c3e50;
  transition: all 0.3s ease;
}

.card {
  transition: transform 0.3s ease;
}
.card:hover {
  transform: translateY(-5px);
}
</style>

<style>
  .post-comments {
    border-top: 1px solid #ddd;
    padding: 10px;
    background: #fafafa;
  }

  .add-comment {
    display: flex;
    margin-top: 8px;
  }

  .comment-input {
    flex: 1;
    padding: 6px 10px;
    border-radius: 5px;
    border: 1px solid #ccc;
  }

  .btn-comment {
    background: #007bff;
    color: white;
    border: none;
    margin-left: 6px;
    padding: 6px 10px;
    border-radius: 5px;
    cursor: pointer;
  }

  .comment-item {
    font-size: 14px;
    margin-top: 5px;
  }

  .like-btn.liked {
    color: #0d6efd;
  }
</style>


  <script>
    // Open Student Modal
    document.getElementById('btnOpenModalAddStudent').addEventListener('click', function () {
      document.getElementById('modalAddStudent').style.display = 'block';
    });
  
    // Close Modal
    document.querySelectorAll('.modal .close').forEach(function (closeBtn) {
      closeBtn.addEventListener('click', function () {
        this.closest('.modal').style.display = 'none';
      });
    });
  
    // Close when clicking outside modal content
    window.addEventListener('click', function (event) {
      if (event.target.classList.contains('modal')) {
        event.target.style.display = 'none';
      }
    });
  </script>
  

  <script>
    function closeInviteModal() {
      console.log('Close Invite');
      document.getElementById('inviteAlumniModal').style.display = 'none';
    }
    </script>

  

  {% comment %} alumni invitation model {% endcomment %}
  <script>

    function openAttendeesModal(eventId) {
      // Open the modal
      document.getElementById("attendeesModal").style.display = "block";
  }
  
  
  function closeAttendeesModal() {
      // Close the modal
      document.getElementById("attendeesModal").style.display = "none";
  }
  

  let currentEventId = null;

  function openInviteModal(eventId, eventName) {
      currentEventId = eventId;
      document.getElementById('inviteModalTitle').textContent = `Invite Alumni to ${eventName}`;
      document.getElementById('inviteAlumniModal').style.display = 'block';
  
      // Reset checkboxes and search
      document.getElementById('alumniSearch').value = '';
      filterAlumni();
      document.querySelectorAll('#inviteAlumniModal input[type="checkbox"]').forEach(cb => cb.checked = false);
  }
  
  function closeInviteModal() {
    console.log('Close Invite');
      document.getElementById('inviteAlumniModal').style.display = 'none';
  }
    
    function filterAlumni() {
        const searchTerm = document.getElementById('alumniSearch').value.toLowerCase();
        const alumniItems = document.querySelectorAll('.alumni-item');
        
        alumniItems.forEach(item => {
            const name = item.querySelector('div > div:first-child').textContent.toLowerCase();
            const email = item.querySelector('div > div:last-child').textContent.toLowerCase();
            item.style.display = (name.includes(searchTerm) || email.includes(searchTerm)) ? 'flex' : 'none';
        });
    }
    
    function selectAllAlumni() {
        const checkboxes = document.querySelectorAll('#inviteAlumniModal input[type="checkbox"]');
        const allChecked = Array.from(checkboxes).every(cb => cb.checked);
        
        checkboxes.forEach(cb => {
            cb.checked = !allChecked;
        });
    }
    
    function sendInvitations() {
        const selectedAlumni = Array.from(
            document.querySelectorAll('#inviteAlumniModal input[type="checkbox"]:checked')
        ).map(cb => cb.value);
        
        if (selectedAlumni.length === 0) {
            alert('Please select at least one alumni to invite.');
            return;
        }
        
        fetch("{% url 'send_event_invitations' %}", {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': '{{ csrf_token }}'
            },
            body: JSON.stringify({
                event_id: currentEventId,
                alumni_ids: selectedAlumni
            })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert('Invitations sent successfully!');
                closeInviteModal();
                location.reload(); // Refresh to show updated counts
            } else {
                alert('Error sending invitations: ' + data.message);
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('An error occurred while sending invitations.');
        });
    }
    
    // Close modal when clicking outside
    window.onclick = function(event) {
        if (event.target == document.getElementById('inviteAlumniModal')) {
            closeInviteModal();
        }
    }
    
    // Initialize search functionality
    document.getElementById('alumniSearch').addEventListener('input', filterAlumni);
    </script>

  {% comment %} posts {% endcomment %}
  <script>
    // Modal Handling
    function showPostModal() {
        document.getElementById('postModal').style.display = 'block';
    }

    function closePostModal() {
        document.getElementById('postModal').style.display = 'none';
    }

    // Event Listeners
    document.addEventListener('DOMContentLoaded', () => {
        // New Post Button
        document.querySelector('.btn-new-post').addEventListener('click', (e) => {
            e.preventDefault();
            showPostModal();
        });

        // Close Modal
        document.querySelector('#postModal .close').addEventListener('click', closePostModal);

        // Close when clicking outside modal
        window.addEventListener('click', (e) => {
            if (e.target === document.getElementById('postModal')) {
                closePostModal();
            }
        });

        // Form Validation
        document.getElementById('postForm').addEventListener('submit', (e) => {
            const content = e.target.content.value.trim();
            const image = e.target.image.files[0];
            
            if (!content && !image) {
                e.preventDefault();
                alert('Please provide either text content or an image');
                e.target.content.focus();
            }
        });
    });

    // Navigation Handling (from previous code)
    document.addEventListener('DOMContentLoaded', function() {
        // ... rest of your navigation code ...
    });

    // ... rest of your existing JavaScript functions ...
</script>

  {% comment %} Search {% endcomment %}
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const searchInput = document.getElementById("alumniSearch");
      const table = document.getElementById("alumniTable");
      const rows = table.querySelectorAll("tbody tr");
    
      
      console.log(searchInput)
      searchInput.addEventListener("input", function () {
        const query = this.value.toLowerCase();
        
        console.log(query)
        // Loop through all rows in the table body
        rows.forEach(function (row) {
          // Get all text content of the row (to compare with the search query)
          const rowText = row.textContent.toLowerCase();
          
          // If the row text contains the search query, show the row
          if (rowText.includes(query)) {
            row.style.display = "";
          } else {
            // Otherwise, hide the row
            row.style.display = "none";
          }
        });
      });
    });
    </script>
    
  

  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const modal = document.getElementById("modalAddJob");
      const btn = document.getElementById("btnOpenModalAddJob");
      const closeBtn = modal.querySelector(".close");
      const form = document.getElementById("jobForm");

      btn.addEventListener("click", () => modal.style.display = "block");
      closeBtn.addEventListener("click", () => modal.style.display = "none");
      window.addEventListener("click", e => { if (e.target === modal) modal.style.display = "none"; });

      form.addEventListener("submit", async function (e) {
        e.preventDefault();
        const formData = new FormData(form);

        const response = await fetch("{% url 'add_job' %}", {
          method: "POST",
          headers: {
            "X-CSRFToken": formData.get('csrfmiddlewaretoken')
          },
          body: formData
        });

        const data = await response.json();
        alert(data.message);
        if (data.success) {
          modal.style.display = "none";
          form.reset();
        }
      });
    });
  </script>

  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const likedPosts = new Set();
  
      // Like Post
      document.querySelectorAll('.like-btn').forEach(button => {
        button.addEventListener('click', function () {
          const postCard = this.closest('.post-card');
          const postId = postCard.getAttribute('data-post-id');
  
          if (likedPosts.has(postId)) {
            alert("You've already liked this post.");
            return;
          }
  
          likedPosts.add(postId);
          this.classList.add('liked');
          this.innerHTML = '<i class="fas fa-thumbs-up"></i> Liked';
        });
      });
  
      // Share Post (Facebook by default)
      document.querySelectorAll('.share-btn').forEach(button => {
        button.addEventListener('click', function () {
          const postUrl = this.getAttribute('data-post-url');
          const shareUrl = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(postUrl)}`;
          window.open(shareUrl, '_blank', 'width=600,height=400');
        });
      });
  
      // Temporary Commenting
      document.querySelectorAll('.btn-comment').forEach(button => {
        button.addEventListener('click', function () {
          const postId = this.getAttribute('data-post-id');
          const input = document.querySelector(`.comment-input[data-post-id="${postId}"]`);
          const commentText = input.value.trim();
  
          if (!commentText) return;
  
          const commentBox = document.getElementById(`comments-${postId}`);
          const newComment = document.createElement('div');
          newComment.classList.add('comment-item');
          newComment.innerHTML = `<strong>You:</strong> ${commentText}`;
          commentBox.appendChild(newComment);
  
          input.value = '';
        });
      });
    });
  </script>
  
  
  

  <script>
    window.addEventListener('load', function() {
      document.querySelector('.loader-wrapper').style.display = 'none';
      document.querySelector('.content').style.display = 'block';
  });
  </script>


  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const cardsGrid = document.querySelector('.cards-grid');
      
      // Card configuration
      const cardData = [
        {
          icon: 'fas fa-users',
          title: 'Total Alumni',
          target: {{ total_alumni }},
          duration: 2000 // 2 seconds
        },
        {
          icon: 'fas fa-calendar-alt',
          title: 'Upcoming Events',
          target: {{ total_events }},
          duration: 1500 // 1.5 seconds
        },
        {
          icon: 'fas fa-coins',
          title: 'Donations',
          target: {{ donation_stats.total_donations }},
          duration: 2500 // 2.5 seconds
        }
      ];
    
      // Create cards with counting animation
      cardData.forEach(card => {
        const cardElement = document.createElement('div');
        cardElement.className = 'card';
        cardElement.innerHTML = `
          <div class="card-header">
            <i class="${card.icon}"></i>
            <h3>${card.title}</h3>
          </div>
          <div class="card-body">
            <p class="counter" data-target="${card.target}">0</p>
          </div>
        `;
        cardsGrid.appendChild(cardElement);
        
        // Start counting animation
        animateCounter(cardElement.querySelector('.counter'), card.target, card.duration);
      });
    
      // Counter animation function
      function animateCounter(element, target, duration) {
        const start = 0;
        const increment = target / (duration / 16); // 60fps
        let current = start;
        
        const timer = setInterval(() => {
          current += increment;
          if (current >= target) {
            clearInterval(timer);
            current = target;
          }
          element.textContent = Math.floor(current);
        }, 16);
      }
    });
    </script>

<script>

  let activeRequests = 0;
  const loader = document.getElementById('pageLoader');

  // Handle initial page load
  window.addEventListener('load', () => {
    loader.style.display = 'none';
  });

  // Intercept all fetch requests
  const originalFetch = window.fetch;
  window.fetch = async (...args) => {
    activeRequests++;
    loader.style.display = 'flex';
    try {
      return await originalFetch(...args);
    } finally {
      activeRequests--;
      if (activeRequests === 0) {
        loader.style.display = 'none';
      }
    }
  };

  // Handle regular link navigation
  document.querySelectorAll('a').forEach(link => {
    link.addEventListener('click', function(e) {
      const href = this.getAttribute('href');
      if (href && !href.startsWith('#')) {
        loader.style.display = 'flex';
      }
    });
  });

  // Handle form submissions
  document.querySelectorAll('form').forEach(form => {
    form.addEventListener('submit', () => {
      loader.style.display = 'flex';
    });
  });

  // Existing confirmLogout function
  function confirmLogout(event) {
    event.preventDefault();
    if (window.confirm('Are you sure you want to logout?')) {
      loader.style.display = 'flex';
      window.location.href = event.target.dataset.logoutUrl;
    }
  }

  function confirmLogout(event) {
    event.preventDefault();
  
    if (window.confirm('Are you sure you want to logout?')) {
      const loaderOverlay = document.getElementById('loader-overlay');
      const logoutUrl = event.target.dataset.logoutUrl;
  
      loaderOverlay.style.display = 'flex';
  
      setTimeout(function() {
        window.location.href = logoutUrl;
      }, 1000);
    }
  }

function validateEventForm() {
  let isValid = true;
  const eventName = document.getElementById('inputEventName').value;
  const eventDate = document.getElementById('inputEventDate').value;
  const location = document.getElementById('inputLocation').value;

  document.querySelectorAll('.error-message').forEach(el => el.textContent = '');

  if (!eventName) {
      document.getElementById('eventNameError').textContent = 'Event name is required.';
      isValid = false;
  }

  if (!eventDate) {
      document.getElementById('eventDateError').textContent = 'Event date is required.';
      isValid = false;
  }

  if (!location) {
      document.getElementById('locationError').textContent = 'Location is required.';
      isValid = false;
  }

  return isValid;
}


  // Handle add alumni button click
  document.getElementById('btnOpenModalAddAlumni').addEventListener('click', function(e) {
    document.getElementById('modalAddAlumni').style.display = 'block';
  });

  // Close modal when clicking on the close button
  document.querySelectorAll('.close').forEach(closeBtn => {
    closeBtn.addEventListener('click', function() {
      this.closest('.modal').style.display = 'none';
    });
  });

  // Close modal when clicking outside of it
  window.addEventListener('click', function(event) {
    if (event.target.classList.contains('modal')) {
      event.target.style.display = 'none';
    }
  });
  
  // Add event listeners
  const modal = document.getElementById('modalEditAlumni');
  const closeBtn = modal.querySelector('.close');
  const form = modal.querySelector('#editAlumniForm');
  
  // Close modal when clicking on the close button
  closeBtn.addEventListener('click', function() {
    modal.remove();
  });
  
  // Close modal when clicking outside of it
  window.addEventListener('click', function(event) {
    if (event.target === modal) {
      modal.remove();
    }
  });
  
  // Handle form submission
  form.addEventListener('submit', function(e) {
    e.preventDefault();
    
    // Validate form
    if (!validateEditForm()) {
      return;
    }
    
    // Show loading state
    const submitBtn = form.querySelector('button[type="submit"]');
    const originalText = submitBtn.textContent;
    submitBtn.textContent = 'Updating...';
    submitBtn.disabled = true;
    
    // Submit the form
    fetch(form.action, {
      method: 'POST',
      body: new FormData(form),
      headers: {
        'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
      }
    })
    .then(response => response.json())
    .then(data => {
      if (data.success) {
        alert('Alumni updated successfully!');
        modal.remove();
        // Refresh the page to show updated data
        window.location.reload();
      } else {
        alert('Error: ' + data.message);
        submitBtn.textContent = originalText;
        submitBtn.disabled = false;
      }
    })
    .catch(error => {
      console.error('Error:', error);
      alert('An error occurred while updating the alumni.');
      submitBtn.textContent = originalText;
      submitBtn.disabled = false;
    });
  });
}

// Function to show loading state
function showLoadingState(sectionId) {
  const section = document.getElementById(sectionId);
  if (section) {
    const loadingOverlay = document.createElement('div');
    loadingOverlay.className = 'loading-overlay';
    loadingOverlay.innerHTML = `
      <div class="loading-spinner"></div>
      <p>Loading...</p>
    `;
    section.appendChild(loadingOverlay);
  }
}

// Function to hide loading state
function hideLoadingState(sectionId) {
  const section = document.getElementById(sectionId);
  if (section) {
    const loadingOverlay = section.querySelector('.loading-overlay');
    if (loadingOverlay) {
      loadingOverlay.remove();
    }
  }
}
  

// Event Management Functions
document.addEventListener('DOMContentLoaded', function() {
  // Handle add event button click
  document.getElementById('btnOpenModalAddEvent').addEventListener('click', function() {
    document.getElementById('modalAddEvent').style.display = 'block';
  });

  // Close modal when clicking on the close button
  document.querySelectorAll('.close').forEach(closeBtn => {
    closeBtn.addEventListener('click', function() {
      this.closest('.modal').style.display = 'none';
    });
  });

  // Close modal when clicking outside of it
  window.addEventListener('click', function(event) {
    if (event.target.classList.contains('modal')) {
      event.target.style.display = 'none';
    }
  });
});

// Post Management Functions
document.addEventListener('DOMContentLoaded', function() {
  // Handle add post button click
  document.getElementById('btnOpenModalAddPost').addEventListener('click', function() {
    showAddPostModal();
  });
});

// Function to validate post form
function validatePostForm() {
  let isValid = true;
  const title = document.getElementById('inputTitle').value;
  const content = document.getElementById('inputContent').value;
  const category = document.getElementById('inputCategory').value;
  const status = document.getElementById('inputStatus').value;

  // Clear previous error messages
  document.querySelectorAll('#modalAddPost .error-message').forEach(el => el.textContent = '');

  if (!title) {
      document.getElementById('titleError').textContent = 'Title is required.';
      isValid = false;
  }

  if (!content) {
      document.getElementById('contentError').textContent = 'Content is required.';
      isValid = false;
  }

  if (!category) {
      document.getElementById('categoryError').textContent = 'Category is required.';
      isValid = false;
  }

  if (!status) {
      document.getElementById('statusError').textContent = 'Status is required.';
      isValid = false;
  }

  return isValid;
}


// Function to validate job form
function validateJobForm() {
  let isValid = true;
  const position = document.getElementById('inputPosition').value;
  const company = document.getElementById('inputCompany').value;
  const location = document.getElementById('inputLocation').value;
  const jobType = document.getElementById('inputJobType').value;
  const description = document.getElementById('inputDescription').value;
  const requirements = document.getElementById('inputRequirements').value;
  const applicationDeadline = document.getElementById('inputApplicationDeadline').value;
  const contactEmail = document.getElementById('inputContactEmail').value;

  // Clear previous error messages
  document.querySelectorAll('#modalAddJob .error-message').forEach(el => el.textContent = '');

  if (!position) {
      document.getElementById('positionError').textContent = 'Position is required.';
      isValid = false;
  }

  if (!company) {
      document.getElementById('companyError').textContent = 'Company is required.';
      isValid = false;
  }

  if (!location) {
      document.getElementById('locationError').textContent = 'Location is required.';
      isValid = false;
  }

  if (!jobType) {
      document.getElementById('jobTypeError').textContent = 'Job type is required.';
      isValid = false;
  }

  if (!description) {
      document.getElementById('descriptionError').textContent = 'Job description is required.';
      isValid = false;
  }

  if (!requirements) {
      document.getElementById('requirementsError').textContent = 'Requirements are required.';
      isValid = false;
  }

  if (!applicationDeadline) {
      document.getElementById('applicationDeadlineError').textContent = 'Application deadline is required.';
      isValid = false;
  }

  if (!contactEmail || !/\S+@\S+\.\S+/.test(contactEmail)) {
      document.getElementById('contactEmailError').textContent = 'Valid contact email is required.';
      isValid = false;
  }

  return isValid;
}
</script>
  
<script src="{% static 'js/script.js' %}"></script>
<script src="{% static 'js/validation.js' %}"></script>

</body>
</html>
